import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.03641bbc.js";const u=JSON.parse('{"title":"GitHub Action 自动部署--部署到阿里云","description":"","frontmatter":{},"headers":[],"relativePath":"deploy/GithubAction/部署阿里云.md","lastUpdated":1700616784000}'),p={name:"deploy/GithubAction/部署阿里云.md"},e=l(`<h1 id="github-action-自动部署-部署到阿里云" tabindex="-1">GitHub Action 自动部署--部署到阿里云 <a class="header-anchor" href="#github-action-自动部署-部署到阿里云" aria-label="Permalink to &quot;GitHub Action 自动部署--部署到阿里云&quot;">​</a></h1><h3 id="github-actions-部署到阿里云" tabindex="-1">Github Actions 部署到阿里云 <a class="header-anchor" href="#github-actions-部署到阿里云" aria-label="Permalink to &quot;Github Actions 部署到阿里云&quot;">​</a></h3><h4 id="初始化阿里云服务器" tabindex="-1">初始化阿里云服务器 <a class="header-anchor" href="#初始化阿里云服务器" aria-label="Permalink to &quot;初始化阿里云服务器&quot;">​</a></h4><ol><li>购买阿里云服务器，选择操作系统，我选的 ubuntu</li><li>在云服务器管理控制台选择实例-&gt;更多-&gt;密钥-&gt;重置实例密码（一会登陆用）</li><li>选择远程连接-&gt;VNC，会弹出一个密码，记住它，以后远程连接要用（ctrl + alt + f1~f6 切换终端，例如 ctrl + alt + f1 是第一个终端）</li><li>进入后是一个命令行 输入 <code>root</code>（默认用户名），密码为你刚才重置的实例密码</li><li>登陆成功， 更新安装源 <code>sudo apt-get update &amp;&amp; sudo apt-get upgrade -y</code></li><li>安装 npm <code>sudo apt-get install npm</code></li><li>安装 npm 管理包 <code>sudo npm install -g n</code></li><li>安装 node 最新稳定版 <code>sudo n stable</code></li></ol><h4 id="创建一个静态服务器" tabindex="-1">创建一个静态服务器 <a class="header-anchor" href="#创建一个静态服务器" aria-label="Permalink to &quot;创建一个静态服务器&quot;">​</a></h4><p>这里只讲述如何将 GitHub 的代码部署到服务器，至于静态服务器，可自行搭建。</p><h4 id="创建阿里云密钥对" tabindex="-1">创建阿里云密钥对 <a class="header-anchor" href="#创建阿里云密钥对" aria-label="Permalink to &quot;创建阿里云密钥对&quot;">​</a></h4><p>请参考<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.alibabacloud.com%2Fhelp%2Fzh%2Fdoc-detail%2F51793.htm" target="_blank" rel="noreferrer">创建 SSH 密钥对</a>和<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.alibabacloud.com%2Fhelp%2Fzh%2Fdoc-detail%2F51796.htm%3Fspm%3Da2c63.p38356.879954.9.cf992580IYf2O7%23concept-zzt-nl1-ydb" target="_blank" rel="noreferrer">绑定 SSH 密钥对</a> ，将你的 ECS 服务器实例和密钥绑定，然后将私钥保存到你的电脑（例如保存在 ecs.pem 文件）。</p><h4 id="连接服务器" tabindex="-1">连接服务器 <a class="header-anchor" href="#连接服务器" aria-label="Permalink to &quot;连接服务器&quot;">​</a></h4><p>1、打开你要部署到阿里云的 Github 项目，点击 <code>setting-&gt;secrets-&gt;Actions-&gt; New repository secret</code> 创建 secret。</p><p><img src="https://qn.huat.xyz/mac/20220212172115.png" alt="image-20220212172115702"></p><p>2、secret 名称为 <code>ALIYUN_ECS_PRIVATE_KEY</code>，并将刚才的阿里云密钥填入内容。</p><p><img src="https://qn.huat.xyz/mac/20220212172502.png" alt="image-20220212172502882"></p><p>同理在配置一下 IP，命名为 <code>ALIYUN_ECS_IP</code> ，IP 是服务器的公网 IP。</p><p>3、在项目下新建 <code>.github\\workflows\\ci.yml</code> 文件：</p><div class="language-yml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Build app and deploy to aliyun</span></span>
<span class="line"><span style="color:#FF9CAC;">on</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">#监听push操作</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">push</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">branches</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;"># master分支，你也可以改成其他分支</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">main</span></span>
<span class="line"><span style="color:#F07178;">jobs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">runs-on</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">steps</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">actions/checkout@v2</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Install npm dependencies</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yarn install</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Run build task</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yarn build</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Deploy to Server</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">easingthemes/ssh-deploy@v2.1.5</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">env</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">SSH_PRIVATE_KEY</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.ALIYUN_ECS_PRIVATE_KEY }}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">ARGS</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-rltgoDzvO --delete</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">SOURCE</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dist</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 这是要复制到阿里云静态服务器的文件夹名称</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">REMOTE_HOST</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.ALIYUN_ECS_IP }}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 你的阿里云公网地址</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">REMOTE_USER</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 阿里云登录后默认为 root 用户，并且所在文件夹为 root</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">TARGET</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/www/wwwroot/xxx</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 打包后的 dist 文件夹将放在 /www/wwwroot/xxx</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>这个 Actions 主要做了两件事：</p><ol><li>克隆你的项目，下载依赖，打包。</li><li>用你的阿里云私钥以 SSH 的方式登录到阿里云，把打包的文件上传（使用 rsync）到阿里云指定的文件夹中。</li></ol>`,18),o=[e];function t(c,r,i,y,D,C){return n(),a("div",null,o)}const F=s(p,[["render",t]]);export{u as __pageData,F as default};
