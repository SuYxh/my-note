## 文档流

**文档流**指节点在排版布局时默认使用从左往右从上往下的流式排列方式。窗体从上往下分成一行行且每行根据从左往右的顺序排列节点，其显著特性就是`从左往右从上往下`。

### 类型

对于一个标准的文档流，可根据其特性对节点分类。

-  HTML级别
  -  容器级元素：`<div>`、`<ul>`、`<li>`等
  -  文本级元素：`<a>`、`<p>`、`<span>`等
-  CSS级别
  -  块级元素：`<div>`、`<ul>`、`<li>`等
  -  行内元素：`<a>`、`<p>`、`<span>`等

### 微观现象

即使是标准的文档流，也不排除存在一些小小的缺陷，以下是三种常见缺陷。

-  **空白折叠**：换行编写行内元素，排版会出现`5px空隙`
-  **高矮不齐**：行内元素统一以底边垂直对齐
-  **自动换行**：排版若一行无法完成则换行接着排版

> 解决方案

空白折叠可能是最易出现的文档流微观现象。

```html
<ul>
	<li></li>
	<li></li>
	<li></li>
</ul>


ul {
	text-align: center;
}
li {
	display: inline-block;
}
```

此时很多浏览器就出现`5px空隙`，解决方案也有很多种。

第一种，必须紧密连接节点。

```html
<ul>
	<li></li><li></li><li></li>
</ul>
```

第二种，子节点声明`margin-left:-5px`。

```css
li {
	display: inline-block;
	margin-left: -5px;
}
```

第三种，父节点使用`Flex布局`。

```css
ul {
	display: flex;
	justify-content: center;
}
```

### 脱流文档流

**脱流文档流**指节点脱流正常文档流后，在正常文档流中的其他节点将忽略该节点并填补其原先空间。文档一旦脱流，计算其父节点高度时不会将其高度纳入，脱流节点不占据空间，因此声明浮动或定位后会对周围节点布局产生或多或少的影响。

文档流的脱流有两种方式。

-  **浮动布局**：`float:left/right`
-  **定位布局**：`position:absolute/fixed`

> Float方式

节点声明`float`脱流时会让其跳出正常文档流，其他节点会忽略该节点并填补其原先空间。该节点的文本内容可不参与脱流效果，却会认同该节点所占据的空间并围绕它布局，这就是`文字环绕效果`的原理。

一句话概括：**节点参与浮动布局后，自身脱流但其文本不脱流**。

> Position方式

节点声明`position`脱流时(只有`absolute/fixed`)会让自身及其文本内容一起跳出正常文档流，其他节点会忽略该节点并填补其原先空间。`absolute`绝对定位是相对往上遍历第一个声明`position:relative/absolute`的祖先节点定位，若无此节点则相对`<body>`定位；`fixed`固定定位是相对浏览器窗口定位。

一句话概括：**节点参与定位布局后，自身及其文本一起脱流**。

### 显隐影响

在正常文档流排版时，经常会声明`display:none`与`visibility:hidden`控制节点的隐藏，`display:none`简称`DN`，`visibility:hidden`简称`VH`。上章提到`DN/VH`的区别，这次看看节点切入隐藏状态后，会存在何种差别。

- 节点不可见但占据空间，显隐时可过渡：`visibility:hidden`
- 节点不可见但占据空间，不可点击：`visibility:hidden`
- 节点不可见不占据空间，可访问DOM：`display:none`
- 节点不可见但占据空间，可点击：`opacity:0`
- 节点不可见不占据空间，可点击：`position:absolute; opacity:0`
- 节点不可见但占据空间，不可点击：`position:relative; z-index:-1`
- 节点不可见不占据空间，不可点击：`position:absolute; z-index:-1`



|                        | display: none | visibility: hidden | opacity: 0 |
| :--------------------- | :------------ | :----------------- | ---------- |
| 页面中                 | 不存在        | 存在               | 存在       |
| 重排                   | 会            | 不会               | 不会       |
| 重绘                   | 会            | 会                 | 不一定     |
| 自身绑定事件           | 不触发        | 不触发             | 可触发     |
| transition             | 不支持        | 支持               | 支持       |
| 子元素可复原           | 不能          | 能                 | 不能       |
| 被遮挡的元素可触发事件 | 能            | 能                 | 不能       |



## 层叠上下文

**层叠上下文**指盒模型在三维空间`Z轴`中的表现行为。每个盒模型存在于一个三维空间中，分别是平面画布的`X轴Y轴`与表示层叠的`Z轴`。

在默认情况下，节点在网页中沿着`X轴`与`Y轴`平铺，很难察觉它们在`Z轴`中的层叠关系。节点一旦发生堆叠，最终表现就是节点间互相覆盖。若一个节点包括层叠上下文，那它就拥有绝对的制高点，使用一个成语贴切表示就是鹤立鸡群，最终表现就是离屏幕观察者更近。

![三维空间](https://qn.huat.xyz/mac/202406121343205.awebp)

声明`position/z-index`可让节点生成层叠上下文。很多同学可能一直认为`z-index`只是声明一个节点在`Z轴`的层叠顺序，值越高离屏幕观察者越近。其实这种认识不全面，还需注意以下情况。

- `z-index`只在声明定位的节点中起效
- 节点在`Z轴`的层叠顺序根据`z-index`、层叠上下文和层叠等级共同决定

### 层叠等级

**层叠等级**又称**层叠级别**，指节点在三维空间`Z轴`中的上下顺序。在同一层叠上下文中，它描述层叠上下文节点在`Z轴`中的上下顺序；在普通节点中，它描述普通节点在`Z轴`中的上下顺序。

普通节点的层叠等级优先由其所在的层叠上下文决定，层叠等级的比较只有在当前层叠上下文中才有意义，脱离当前层叠上下文的比较就变得无意义了。

> 成因

很多同学认为只有声明`position/z-index`才能让节点生成层叠上下文，其实不仅只有这两个属性，还有一些条件也能让节点生成层叠上下文。

- `<html>`根结点
- `Flex布局`中声明`z-index`不为`auto`的节点
- `Grid布局`中声明`z-index`不为`auto`的节点
- 声明`position:relative/absolute`与`z-index`不为`auto`的节点
- 声明`position:fixed/sticky`的节点
- 声明`mask/mask-image/mask-border`不为`none`的节点
- 声明`filter`不为`none`的节点
- 声明`mix-blend-mode`不为`normal`的节点
- 声明`opacity`不为`1`的节点
- 声明`clip-path`不为`none`的节点
- 声明`will-change`不为`initial`的节点
- 声明`perspective`不为`none`的节点
- 声明`transform`不为`none`的节点
- 声明`isolation`为`isolate`的节点
- 声明`-webkit-overflow-scrolling`为`touch`的节点

### 层叠顺序

**层叠顺序**指节点发生层叠时根据指定顺序规则在`Z轴`中垂直显示。

> 脱流节点的层叠顺序

在同一层叠上下文中，节点根据`z-index`的大小从上到下层叠，若`z-index`一样则后面的节点层叠等级要大于前面的节点。脱流节点的层叠顺序看`z-index`的大小。

> 标准流节点的层叠顺序

标准流节点的层叠顺序稍微有点难记，我也未找到特别的记忆方式，只能死记硬背了。以下是层叠顺序从低到高的排列。

- 层叠上下文的`border/background`
- `z-index<0`的节点
- 标准流内块级非定位的节点
- 浮动非定位的节点
- 标准流内行内非定位的节点
- `z-index:auto/0`的节点
- `z-index>0`的节点

![标准流层叠顺序](https://qn.huat.xyz/mac/202406121343405.awebp)

![img](https://qn.huat.xyz/mac/202406121343599.svg)上一章下一章![img](https://qn.huat.xyz/mac/202406121343639.svg)

留言

评论 