## 格式化上下文

上述多次提到`格式化上下文`的字眼，那`格式化上下文`又是何方神圣？了解`格式化上下文`，就能更易理解上述内容了。

**格式化上下文**指决定渲染区域内节点的排版、关系和互相作用的渲染规则。简而言之，网页中有一个`<ul>`及其多个子节点`<li>`，`格式上下文`决定这些`<li>`如何排版，`<li>`与`<li>`间处于何种关系，以及`<li>`与`<li>`间如何互相影响。

`格式上下文`由以下部分组成，其中**块格式化上下文**与**行内格式化上下文**最重要。

| 上下文               | 缩写  | 版本 | 声明         |
| -------------------- | ----- | ---- | ------------ |
| **块格式化上下文**   | `BFC` | `2`  | 块级盒子容器 |
| **行内格式化上下文** | `IFC` | `2`  | 行内盒子容器 |
| **弹性格式化上下文** | `FFC` | `3`  | 弹性盒子容器 |
| **格栅格式化上下文** | `GFC` | `3`  | 格栅盒子容器 |



```!
!

复制代码读中文读起来有点拗口，干脆读英文缩写好了，有兴趣的同学自行查阅MDN了解其英文单词
```

为了防止有些同学对`格式化上下文`的概念越看越混乱，本章不会过多解说`格式化上下文`，但我会抽丝剥茧把`格式化上下文`的概念清晰化，更多的解读可自行查找相关资料深入学习。有时学习点到即止也未尝不是一件好事，过多解读反而达不到想要的效果。

### 块格式化上下文

`BFC`是网页中一个独立且隔离的渲染区域，容器中的子节点不会在布局中影响到外面的节点，反之亦然。

以下是我意译`W3C标准`与平时一些开发经验的总结所得，也结合一些自己对`BFC`的理解。

> 规则

- 节点在垂直方向上按顺序排列
- 节点的垂直方向距离由`margin`决定，相邻节点的`margin`会发生重叠，以最大`margin`为合并值
- 节点的`margin-left/right`与父节点的`左边/右边`相接触，即使处于浮动也如此，除非自行形成`BFC`
- `BFC`是一个隔离且不受外界影响的独立容器
- `BFC`不会与同级浮动区域重叠
- `BFC`在计算高度时其浮动子节点也参与计算

> 成因

- 根节点：`html`
- 非溢出可见节点：`overflow:!visible`
- 浮动节点：`float:left/right`
- 绝对定位节点：`position:absolute/fixed`
- 被定义为块级的非块级节点：`display:inline-block/table-cell/table-caption/flex/inline-flex/grid/inline-grid`
- 父节点与正常文档流的子节点(非浮动)自动形成`BFC`

> 场景

- 清除浮动
- 已知宽度水平居中
- 防止浮动节点被覆盖
- 防止垂直`margin`合并

`margin塌陷`在排版时稍微不注意就会出现，可用`BFC`的概念回答了。所谓的塌陷其实是两个`BFC`的相邻盒或父子盒互相作用时产生的效果，两个盒子会取相邻边最大`margin`作为相邻边的共用`margin`。

在此再补充一些`margin折叠`的计算问题。

- 两个盒子相邻边的`margin`都为正值，取最大值
- 两个盒子相邻边的`margin`都为负值，取最小值，两者会互相重合
- 两个盒子相邻边的`margin`一正一负，取两者相加值，若结果为负，两者会互相重合

### 行内格式化上下文

`IFC`的高度由容器中最大高度的子节点的实际高度确定，不受垂直方向的`margin/padding`的影响。另外，`IFC`中不能存在块元素，若加入块元素则会产生相应个数的匿名块并互相隔离，即产生相应个数的`IFC`，每个`IFC`对外表现为块级元素并垂直排列。

以下是我意译`W3C标准`与平时一些开发经验的总结所得，也结合一些自己对`IFC`的理解。

> 规则

- 节点在水平方向上按顺序排列
- 节点无法声明宽高，其`margin/padding`在水平方向有效在垂直方向无效
- 节点在垂直方向上以不同形式对齐
- 节点宽度由包括块与浮动决定，节点高度由行高决定

> 成因

- 声明`display:inline[-x]`形成行内元素
- 声明`line-height`
- 声明`vertical-align`
- 声明`font-size`

### 弹性格式化上下文

声明`display`为`flex`或`inline-flex`时，节点会生成一个`FFC`的独立容器，主要用于响应式布局。

### 格栅格式化上下文

声明`display`为`grid`或`inline-grid`时，节点会生成一个`GFC`的独立容器，主要用于响应式布局。

`GFC`有点像`<table>`，同为二维表格，但`GFC`有更丰富的属性控制行列、对齐以及更为精细的渲染语义与控制。不过因为兼容性不是特别好，所以也不会讲述基于`GFC`的格栅布局了。
