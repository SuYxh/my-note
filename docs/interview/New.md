## 2024.09

### å·¥ä½œç»å†

1ã€è´Ÿè´£æ¸¸æˆè´¦å·å”®å–ä¸ç§Ÿèµä¸šåŠ¡ä»¥åŠå¥¢ä¾ˆå“å›æ”¶ç›¸å…³ä¸šåŠ¡çš„å¸¸è§„éœ€æ±‚è¿­ä»£å·¥ä½œ 

2ã€é’ˆå¯¹æ¸¸æˆä¸šåŠ¡çš„é¦–é¡µè¿›è¡Œä¼˜åŒ–ï¼Œä½¿ç”¨å¼‚æ­¥ç»„ä»¶çš„ç­–ç•¥æ¥å°è£…è§†é¢‘æŒ‚ä»¶ï¼ŒåŒæ—¶æ¨åŠ¨åç«¯ä¼™ä¼´è¿›è¡Œæ¥å£åˆå¹¶ï¼Œç”±äº 13 ä¸ªæ¥å£åˆ å¹¶è‡³ 6 ä¸ªï¼Œå¹¶é‡‡ç”¨äº†é¢„æ¸²æŸ“æŠ€æœ¯ï¼Œå°†åŸæœ¬ 1800 mså·¦å³çš„é¦–è¯„æ—¶é—´å‡å°‘åˆ° 204 mså·¦å³ï¼Œè¾¾åˆ°ç§’å¼€çš„æ•ˆæœï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€‚ 

3ã€é€šè¿‡åˆ†æç‹è€…è¥åœ°æ•°æ®å¹¶è®¾è®¡äº†æ•°æ®çˆ¬å–æœåŠ¡ï¼Œåœ¨ç”¨æˆ·åŒæ„ä½¿ç”¨å…¶ç›¸å…³æ•°æ®çš„åè®®ä¸‹ï¼Œè·å–åˆ°å…¶åœ¨å¹³å°å‡ºå”®è´¦å·çš„èµ„äº§ä¿¡ æ¯ï¼Œä¸ºæœç´¢æä¾›äº†æ•°æ®æ”¯æŒï¼ŒåŒæ—¶æé«˜äº†è´¦å·çš„çœŸå®æ€§ï¼Œå…·é«˜æ–¯å¹³å°ç»Ÿè®¡ï¼Œæ¸¸æˆè´¦å·æ”¯ä»˜ç‡æå‡0.5%ï¼Œæ¯å¤©å¢åŠ 100-150å• é‡ï¼Œæœˆæ”¶å…¥å¢é•¿è¶…è¿‡30å¤šä¸‡å…ƒ 

4ã€é‡æ„å¥¢ä¾ˆå“å“ç‰Œé€‰æ‹©é¡µé¢çš„æœç´¢é€»è¾‘ï¼Œç”±äºä¹‹å‰çš„å…¨ç­‰åŒ¹é…ä¿®æ”¹æˆä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼é…åˆç»„åˆæ¨¡å¼çš„æ–¹å¼è¿›è¡ŒåŒ¹é…ï¼Œæé«˜äº†æœ ç´¢å‘½ä¸­ç‡ï¼Œç›´æ¥æå‡äº† 7% çš„ä¼°ä»·è½¬åŒ–ç‡ï¼Œåç»­è¿˜æ–°å¢äº† AI æœç´¢ã€‚

5ã€åŸºäº zz-cli æ­å»ºäº† React + Umi æŠ€æœ¯æ ˆçš„å¥¢ä¾ˆå“ç®¡ç†åå°é¡¹ç›®ï¼Œ å°è£…äº†åå°ä¸­å¸¸ç”¨çš„èƒ½åŠ›ä»¥åŠç›¸å…³çš„æ¨¡æ¿ï¼Œå®ç°é«˜æ•ˆå¼€ å‘ï¼Œå¹¶æ¥å…¥äº†å…¬å¸çš„ SSO å¹³å°ï¼Œä»¥åŠRBAC æƒé™ç®¡ç†ç³»ç»Ÿ;ä»¥åŠä¸ç‚¹æ§äº‘å¹³å°åˆä½œï¼Œæ‹“å±•æ‰“ç”µè¯åŠŸèƒ½ï¼Œæå‡ç”¨æˆ·æœåŠ¡ä½“éªŒã€‚ 

6ã€å¼€å‘äº†å›¢é˜Ÿçš„ vscode æ’ä»¶ï¼Œé’ˆå¯¹å¸¸ç”¨ç»„ä»¶åº“ zzui æä¾›äº†é…å¥—çš„æ”¯æŒï¼Œæ”¯æŒè‡ªåŠ¨å¯¼å…¥ç»„ä»¶ã€use ç»„ä»¶ç­‰ä¸€äº›åŸºç¡€èƒ½åŠ›ï¼Œæ å¤§çš„æé«˜äº†å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡ï¼Œå¹¶ä¸åŸºç¡€æ”¯æ’‘ç»„çš„åŒå­¦è¿›è¡Œåˆä½œï¼Œä¸ºæ’ä»¶å¢åŠ äº† AI çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬ä»£ç æ™ºèƒ½ç”Ÿæˆã€è§£è¯»ã€ä¼˜åŒ–ã€æµ‹ è¯•ç­‰åŠŸèƒ½ï¼Œæå¤§åœ°ä¸°å¯Œäº†å¼€å‘ä½“éªŒã€‚

7ã€å‚ä¸åŸºç¡€åº“ native-adapterã€zzuiã€js-sdk ç­‰åŸºç¡€çš„ç»´æŠ¤ã€‚







### é¡¹ç›®é—®é¢˜é¢„è®¾

#### å¥¢ä¾ˆå“å›æ”¶C2Pé¡¹ç›®

å¥¢ä¾ˆå“å›æ”¶C2Pé¡¹ç›®æ˜¯å…¬å¸è¿‘å¹´æ¥é‡ç‚¹æŠ•å…¥çš„å“ç±»ä¹‹ä¸€ã€‚ä¸šåŠ¡çš„å‘å±•å¸¦æ¥äº†å›æ”¶å•é‡çš„æå‡ï¼Œç”±äºå®¢å•ä»·è¾ƒé«˜ï¼Œä¹Ÿå¸¦æ¥äº†è¾ƒå¤§çš„èµ„é‡‘å‹åŠ›ä¸é£é™©ã€‚å…¬å¸ç§¯ææ¢ç´¢äº†ä¸€ç§æ–°çš„ä¸šåŠ¡æ¨¡å¼ï¼ŒC2P æ¨¡å¼ï¼Œç®€å•çš„è¯´å°±æ˜¯å°†ç”¨æˆ·çš„å¥¢ä¾ˆå“é”€å”®ç»™å•†å®¶ï¼Œå¹¶é€šè¿‡ç«æ‹æœºåˆ¶ç¡®ä¿æœ€ä½³ä»·æ ¼ï¼ŒåŒæ—¶å…¬å¸æä¾›å…œåº•ä¿éšœã€‚åŒæ—¶ä¹Ÿä¸ºäº†ç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„å›æ”¶ä½“éªŒï¼Œæ”¯æŒä¸Šé—¨å›æ”¶å’Œé‚®å¯„å›æ”¶ã€‚


æŠ€æœ¯æ ˆï¼š vue + vue-router + pinia + native-adapter + js-sdk + zzui


1ã€é€šè¿‡é¢„æ¸²æŸ“æŠ€æœ¯ï¼Œå“ç‰Œé€‰æ‹©é¡µé¢çš„åŠ è½½æ—¶é—´ä»1475mså¤§å¹…é™ä½è‡³177msï¼Œæ˜¾è‘—æå‡äº†ç”¨æˆ·ä½“éªŒã€‚
2ã€å°†é¢„æ¸²æŸ“çš„é€»è¾‘å°è£…æˆäº† zzPreRender hookï¼Œç®€åŒ–äº†åŸå…ˆå¤æ‚çš„æ¥å…¥æ­¥éª¤ï¼Œæ–¹ä¾¿åœ¨æœ¬ä¸šåŠ¡ä¸­è¿›è¡Œæ¥å…¥ï¼›åç»­å‡çº§ä¸º NPM åŒ…ï¼Œæ–¹ä¾¿å…¶ä»–ä¸šåŠ¡è¿›è¡Œä½¿ç”¨ï¼Œå‡å°‘äº†å¯¹ä¸šåŠ¡ä»£ç çš„ä¾µå…¥ã€‚
3ã€å“ç‰Œé€‰æ‹©é¡µæ‰¿è½½äº† 4 ä¸ªç«¯çš„å“ç‰Œå“ç±»é€‰æ‹©åŠŸèƒ½ä»¥åŠ AB æµ‹åŠŸèƒ½ï¼Œè®¾è®¡ä¸Šé‡‡ç”¨äº†ç­–ç•¥æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œåˆ†å‘æ•°æ®ï¼Œç¡®ä¿ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤ã€‚
4ã€åœ¨ç”¨æˆ·é€‰æ‹©å“ç±»ã€ç³»åˆ—ã€æ¬¾å¼ã€å‚æ•°ç­‰é˜¶æ®µï¼Œæ¯ä¸ªæ“ä½œéƒ½å¯èƒ½æœ‰4ç§ä¸åŒçš„ç»“æœã€‚å°è£…äº†useNextStep hookï¼Œå¹¶åœ¨è¿™äº›é˜¶æ®µç»Ÿä¸€ä½¿ç”¨handleNextStepæ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œç¡®ä¿ä¸åŒé˜¶æ®µçš„å¤„ç†é€»è¾‘æ¸…æ™°ä¸”æ˜“ç»´æŠ¤ã€‚
5 ã€ä½¿ç”¨ vue.extend() å®ç°å‡½æ•°è°ƒç”¨æ–¹å¼çš„å®¢æœå¼¹çª—ç»„ä»¶ï¼Œé¿å…åœ¨å¤šä¸ªé¡µé¢é‡å¤å¼•å…¥ï¼Œæé«˜äº†ä»£ç å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
6ã€æ ¹æ®å›¾ç‰‡å®é™…å°ºå¯¸åŠ¨æ€è°ƒæ•´æ ·å¼ï¼Œç¡®ä¿å›¾ç‰‡åœ¨å®¹å™¨ä¸­å‚ç›´å±…ä¸­æ˜¾ç¤ºï¼Œå¹¶å°è£…ä¸ºå¥¢ä¾ˆå“ä¸“ç”¨ç»„ä»¶ï¼Œæ”¯æŒæŸ¥çœ‹åŸå›¾å’Œå›¾ç‰‡æ‡’åŠ è½½ï¼Œå¹¶æ”¾å…¥å†…éƒ¨ç»„ä»¶åº“ ZZUIï¼Œ æ–¹ä¾¿ä¸­å°ç­‰å…¶ä»–éƒ¨é—¨ä½¿ç”¨ã€‚
7ã€ä¿®æ”¹åŸºç¡€åº“ native-adapter çš„ ZZAdapter é€‚é…å™¨ï¼Œè®©å…¶æ”¯æŒä¸Šé—¨å›æ”¶å¸ˆã€é‰´å®šå¸ˆå’Œå•†å®¶ç«¯APPè°ƒç”¨ native çš„èƒ½åŠ›
8ã€ä¼ä¸šå¾®ä¿¡ä¾§è¾¹æ å¼€å‘ï¼Œä½¿ç”¨ getCurExternalContact API è·å–å½“å‰è”ç³»äººä¿¡æ¯ï¼Œå¹¶åˆ©ç”¨å…¶userIdè·å–ç”¨æˆ·åå¥½ä¿¡æ¯ï¼Œå¢å¼ºç§åŸŸæœåŠ¡èƒ½åŠ›ï¼›ä½¿ç”¨ paste äº‹ä»¶ç»•è¿‡ä¼ä¸šå¾®ä¿¡çš„é™åˆ¶å®ç°æ–‡ä»¶å¤åˆ¶çš„é—®é¢˜ï¼Œæå‡å®¢æœæ•ˆç‡ã€‚

 

##### éš¾ç‚¹

- æ–¹æ¡ˆè®¾è®¡





##### vue å¼‚æ­¥ç»„ä»¶çš„ä½¿ç”¨ä»¥åŠåŸç†

Vue å¼‚æ­¥ç»„ä»¶æ˜¯ä¸€ç§æŒ‰éœ€åŠ è½½ç»„ä»¶çš„æ–¹å¼ï¼Œå…è®¸åœ¨éœ€è¦æ—¶æ‰åŠ è½½ç»„ä»¶çš„ä»£ç ï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨å¯åŠ¨æ—¶ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ç»„ä»¶ã€‚è¿™æœ‰åŠ©äºå‡å°‘åˆå§‹åŠ è½½æ—¶é—´ï¼Œæé«˜åº”ç”¨æ€§èƒ½ã€‚

```js
// ä½¿ç”¨
const AsyncComponent = () => ({
  // è¦åŠ è½½çš„ç»„ä»¶ï¼ˆéœ€è¦æ˜¯ä¸€ä¸ª Promiseï¼‰
  component: import('./MyComponent.vue'),
  // åŠ è½½ä¸­åº”å½“æ¸²æŸ“çš„ç»„ä»¶
  loading: LoadingComponent,
  // å‡ºé”™æ—¶æ¸²æŸ“çš„ç»„ä»¶
  error: ErrorComponent,
  // å±•ç¤ºåŠ è½½ä¸­ç»„ä»¶å‰çš„å»¶è¿Ÿæ—¶é—´ï¼Œé»˜è®¤ 200ms
  delay: 200,
  // æœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œè¶…å‡ºæ­¤æ—¶é—´åˆ™æ¸²æŸ“é”™è¯¯ç»„ä»¶ï¼Œé»˜è®¤ï¼šInfinity
  timeout: 3000
});

// å®ç°
// defineAsyncComponent å‡½æ•°ç”¨äºå®šä¹‰ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ï¼Œæ¥æ”¶ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶åŠ è½½å™¨ä½œä¸ºå‚æ•°
function defineAsyncComponent(loader) {
  // ä¸€ä¸ªå˜é‡ï¼Œç”¨æ¥å­˜å‚¨å¼‚æ­¥åŠ è½½çš„ç»„ä»¶
  let InnerComp = null;

  // è¿”å›ä¸€ä¸ªåŒ…è£…ç»„ä»¶
  return {
    name: "AsyncComponentWrapper",
    setup() {
      // å¼‚æ­¥ç»„ä»¶æ˜¯å¦åŠ è½½æˆåŠŸ
      const loaded = ref(false);

      // æ‰§è¡ŒåŠ è½½å™¨å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª Promise å®ä¾‹
      // åŠ è½½æˆåŠŸåï¼Œå°†åŠ è½½æˆåŠŸçš„ç»„ä»¶èµ‹å€¼ç»™ InnerCompï¼Œå¹¶å°† loaded æ ‡è®°ä¸º trueï¼Œä»£è¡¨åŠ è½½æˆåŠŸ
      loader().then((c) => {
        InnerComp = c;
        loaded.value = true;
      });

      return () => {
        // å¦‚æœå¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸï¼Œåˆ™æ¸²æŸ“è¯¥ç»„ä»¶ï¼Œå¦åˆ™æ¸²æŸ“ä¸€ä¸ªå ä½å†…å®¹
        return loaded.value
          ? { type: InnerComp }
          : { type: Text, children: "" };
      };
    },
  };
}
```



##### webpack ä»£ç åˆ†å‰²

ä½¿ç”¨ `import()` è¯­æ³•ä¼šå‘Šè¯‰æ‰“åŒ…å·¥å…·ï¼ˆå¦‚ webpackï¼‰å¯¹ä»£ç è¿›è¡Œåˆ†å‰²ã€‚æ¯ä¸ªå¼‚æ­¥ç»„ä»¶çš„ä»£ç ä¼šè¢«åˆ†å‰²æˆä¸€ä¸ªå•ç‹¬çš„ä»£ç å—ï¼ˆchunkï¼‰ï¼Œåœ¨éœ€è¦æ—¶æ‰ä¼šåŠ è½½ã€‚

å‚è€ƒï¼š [ES æ¨¡å—ä¸ webpack ä»£ç åˆ†å‰².md](./ES æ¨¡å—ä¸ webpack ä»£ç åˆ†å‰².md)



##### é¢„æ¸²æŸ“

1ã€å®¢æˆ·ç«¯é€šè¿‡å†…ç½®æˆ–è€…æ¥å£ä¸‹å‘æ¥è§¦å‘é¢„æ¸²æŸ“ã€‚æ¥å£ä¼šå‘Šè¯‰å®¢æˆ·ç«¯åœ¨aé¡µé¢æ¥å¸®åŠ©æ¸²æŸ“bé¡µé¢

2ã€å½“æˆ‘ä»¬åœ¨aé¡µé¢çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šæ‰“å¼€ä¸€ä¸ªå°webviewæ¥åŠ è½½bé¡µé¢

3ã€bé¡µé¢é€šè¿‡urlä¸Šçš„isPreRender =1æ¥åˆ¤æ–­æ˜¯å¦æ˜¯æ¸²æŸ“ä¸­ï¼Œwindow.zzPreRenderä¸å‡†ç¡®ä¸è¦ä½¿ç”¨

4ã€å¦‚æœæ˜¯é¢„æ¸²æŸ“å°±ä¼šåœ¨ä»£ç é‡Œé¢åšä¸€äº›ç‰¹æ®Šçš„å¤„ç†ã€‚æ¯”å¦‚é¢„æ¸²æŸ“å°±ä¸å‘é€æ¥å£è¯·æ±‚ã€‚åªæ¸²æŸ“éª¨æ¶

5ã€é¡µé¢å®Œæˆæ¸²æŸ“ï¼Œé€šè¿‡sdké€šçŸ¥å®¢æˆ·ç«¯bé¡µé¢æ¸²æŸ“å®Œæˆï¼Œå¯ä»¥ä½¿ç”¨ï¼ŒåŒæ—¶æ³¨å†Œä¸€ä¸ªé¡µé¢è¢«ä½¿ç”¨æ—¶çš„å›è°ƒå‡½æ•°

6ã€å½“aé¡µé¡µé¢è·³è½¬åˆ°bé¡µé¢æ—¶ï¼Œå®¢æˆ·ç«¯åˆ¤æ–­bé¡µé¢å­˜åœ¨å¯ä»¥ä½¿ç”¨çš„å·²å®Œæˆé¢„æ¸²æŸ“çš„webviewï¼Œå°±ç›´æ¥ä½¿ç”¨

7ã€å½“bé¡µçœŸæ­£æ‰“å¼€çš„æ—¶å€™ï¼Œæ€ä¹ˆå»è§¦å‘æ¥å£è¯·æ±‚å‘¢ã€‚æ˜¯é€šè¿‡ä¹‹å‰å›è°ƒå‡½æ•°çš„è§¦å‘åç»­çš„é€»è¾‘ï¼ŒåŒæ—¶ä¿®æ”¹æœ¬åœ°location.hrefçš„å€¼

8ã€è¿™ä¸ªé¢„æ¸²æŸ“å°±è¢«ä½¿ç”¨äº†ã€‚åŒæ—¶è¿™ä¸ªwebviewå°±åŠ åˆ°é¡µé¢æ ˆé‡Œé¢ã€‚å¦‚æœä¸‹æ¬¡åœ¨æ‰“å¼€aé¡µé¢ã€‚å®¢æˆ·ç«¯åˆ¤æ–­å·²ç»ä¸å­˜åœ¨bé¡µé¢å¯ç”¨å®Œæˆé¢„æ¸²æŸ“çš„webviewã€‚aé¡µé¢è¿˜æ˜¯ä¼šè¿›è¡Œbé¡µé¢çš„æ¸²æŸ“



###### æ³¨æ„çš„é—®é¢˜

1ã€éœ€è¦é…ç½®

2ã€å‘½ä¸­ç‡é—®é¢˜

3ã€url ä¸Šæ²¡æœ‰ä¸šåŠ¡å‚æ•°

4ã€app v9.11.0+ ç‰ˆæœ¬

5ã€è§†é¢‘åŠ è½½ è§£ç ä¹‹ç±»çš„é€»è¾‘ æ”¾åˆ° onViewWillAppear æ—¶åºä¹‹åè¿›è¡Œï¼Œåå°è§†é¢‘è§£æä¹‹ç±»æ“ä½œä¼šæ¶ˆåŒ–å¤§é‡å†…å­˜ å¯¼è‡´å®‰å“å´©æºƒç‡ä¸Šå‡



##### é¢„è¯·æ±‚

![image2022-6-30_21-26-27](https://qn.huat.xyz/mac/202409151442219.png)

é¦–å…ˆï¼Œç”¨æˆ·ç‚¹å‡»æ‰“å¼€ Webviewï¼ŒApp è¯·æ±‚ Ajax åˆ—è¡¨çš„æ¥å£å¹¶ä¸”æŠŠæœ¬åœ°çš„ä¸Šæ¬¡è¯·æ±‚çš„æ•°æ®åˆ é™¤ï¼ŒåŒæ—¶åŠ è½½ WebViewã€‚

JS åœ¨è¯·æ±‚æ¥å£æ—¶ï¼Œå…ˆé€šè¿‡ JSBridge å–æ•°æ®ï¼ŒKey æ”¯æŒå¤šä¸ªå€¼ä¸€èµ·ä¼ ã€‚

å¦‚æœæ•°æ®åœ¨ JSBridge è¯·æ±‚ä¹‹å‰è¿”å›ï¼ŒæŠŠæ•°æ®å†™å…¥æœ¬åœ°å¯¹åº” Key çš„ Valueï¼ŒJSBridge è¯»å–åè¿”å›æ•°æ®ã€‚

å¦‚ä½•æ²¡æœ‰è¿”å›ï¼Œè¯»å–æœ¬åœ° Key ä¸ºç©ºï¼Œç›´æ¥è¿”å›ç©ºã€‚

æ¥å£è¿”å›çš„æ•°æ® App ç«¯ä¸ç”¨åšä»»ä½•åˆ¤æ–­å’Œå¤„ç†ã€‚å¦‚æœæ²¡æœ‰å–åˆ°ï¼Œé¡µé¢å†æ¬¡é€šè¿‡ JS å‘èµ·è¯·æ±‚ï¼Œä¹‹åçš„è¶…æ—¶é‡æ–°è¯·æ±‚ç­‰ç­–ç•¥ä¿æŒä¸€è‡´ã€‚



##### ä¼å¾®ä¾§è¾¹æ 

![7874a960-61ec-4792-a9f3-256ebeebd72e](https://qn.huat.xyz/mac/202409151613763.png)

// agentConfig è¿”å›å€¼åœ¨ windows å’Œ mac ä¸Šæ ¼å¼ä¸ä¸€æ ·

```js
import zzfetch from '@zz/fetch'

export function initWorkWXConfig() {
  return new Promise((resolve, reject) => {
    zzfetch({
      url: `https://wxmsg.zhuanspirit.com/api/getJSApiSignature?url=${window.encodeURIComponent(location.href)}&enterpriseId=0&code=1009`
    }).then(res => {
      const { appId, noncestr, signature, timestamp } = res.resp
      if (wx.agentConfig) {
        wx.agentConfig({
          corpid: appId, // å¿…å¡«ï¼Œä¼ä¸šå¾®ä¿¡çš„corpidï¼Œå¿…é¡»ä¸å½“å‰ç™»å½•çš„ä¼ä¸šä¸€è‡´
          agentid: '1000424', // å¿…å¡«ï¼Œä¼ä¸šå¾®ä¿¡çš„åº”ç”¨id 1000348
          timestamp, // å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„æ—¶é—´æˆ³
          nonceStr: noncestr, // å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„éšæœºä¸²
          signature, // å¿…å¡«ï¼Œç­¾åï¼Œè§é™„å½•-JS-SDKä½¿ç”¨æƒé™ç­¾åç®—æ³•
          jsApiList: ['getCurExternalContact', 'getContext'], //å¿…å¡«ï¼Œä¼ å…¥éœ€è¦ä½¿ç”¨çš„æ¥å£åç§°
          success: function(res) {
            console.log('===========wxconfig success', res)
            resolve(res)
          },
          fail: function(res) {
            console.log('===========wxconfig fail', res)
            reject(res)
          }
        });
      }
    })
  })
}

export async function getCurExternalUserId() {
  const wxConfigResult = await initWorkWXConfig()
  console.log('getCurExternalUserId========wxConfigResult', wxConfigResult);
  return new Promise((resolve, reject) => {
    // @ts-ignore
    wx?.invoke('getCurExternalContact', {}, function(res) {
      if (res.err_msg == 'getCurExternalContact:ok') {
        // è¿”å›å½“å‰å¤–éƒ¨è”ç³»äººuserId
        const { userId } = res
        resolve(userId)
      } else {
        //é”™è¯¯å¤„ç†
        reject(new Error('getCurExternalContactè°ƒç”¨æŠ¥é”™'))
      }
    });
  })
}
```



##### å‰ç«¯æœç´¢

å¦‚ä½•è§£æç”¨æˆ·è¾“å…¥ï¼šä½¿ç”¨æ­£åˆ™æå–å‡ºç”¨æˆ·è¾“å…¥çš„ æ±‰å­—ã€å­—æ¯ã€æ•°å­—ï¼Œç„¶ååˆå¹¶æˆä¸ºä¸€ä¸ªæ•°ç»„

// åŒ¹é…æ±‰å­—  const zhReg = /[\u4e00-\u9fa5]+/g

// åŒ¹é…æ•°å­— const numReg = /[\d]+/g

// åŒ¹é…å­—æ¯  const letterReg = /[a-zA-Z]+/g



å¦‚ä½•è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼š

- å•ä¸€å­—æ®µåŒ¹é…ï¼š æ ¹æ®æ ‡é¢˜ï¼Œç„¶åå»é‡ [...**new** *Set*(allSelect)]
- å¤šå­—æ®µåŒ¹é…ï¼š æ ¹æ®æ ‡é¢˜å’Œæè¿°ï¼Œç„¶åå»é‡ [...**new** *Set*(allSelect)]

ä»¥ä¸ºbrandNameåŒ¹é…ä¸ºä¾‹ï¼Œæ‹¿åˆ°æ•°æ®æºæŸä¸€æ¡çš„brandName å’Œ è§£æå‡ºçš„ç”¨æˆ·è¯ç»„ï¼Œ åˆ¤æ–­ brandName  ä¸­æ˜¯å¦åŒ…å«ç”¨æˆ·è¾“å…¥çš„keywordè¿›è¡Œåˆ†è¯åçš„æ•°æ®



å¦‚ä½•è¿›è¡Œç»“æœé«˜äº®: åŠ¨æ€æ­£åˆ™

```js
inputArr.value.forEach((key) => {
  const reg = new RegExp(key, 'i')
  replaceText = replaceText.replace(
    text.match(reg)?.[0],
    `<em style="color: #ff483c">${text.match(reg)?.[0]}</em>`
  )
})
```



##### é¦–å±æ—¶é—´è®¡ç®—







#### **å¥¢ä¾ˆå“ç®¡ç†åå°**


å¥¢ä¾ˆå“ç®¡ç†åå°æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„ç®¡ç†å¹³å°ï¼Œæ¶µç›–äº†çº¿ç´¢ç®¡ç†ã€å¤–å‘¼ç»Ÿè®¡ã€ä¸Šé—¨ç®¡ç†ã€å¥¢ä¾ˆå“é‰´å®šã€æˆè‰²æ¨¡æ¿é…ç½®ä»¥åŠå›æ”¶å•æŸ¥è¯¢ç­‰å¤šä¸ªåŠŸèƒ½æ¨¡å—ã€‚è¯¥å¹³å°æ—¨åœ¨ä¸ºå®¢æœã€è¿è¥å›¢é˜Ÿæä¾›ä¸€ä¸ªé«˜æ•ˆã€å®‰å…¨çš„å·¥ä½œç¯å¢ƒï¼Œä»¥æ”¯æŒå¥¢ä¾ˆå“å›æ”¶ä¸šåŠ¡çš„é¡ºåˆ©è¿›è¡Œã€‚

æŠ€æœ¯æ ˆï¼š React + Umi4 + antd

èŒè´£ï¼š
1ã€åŸºäºWebSocketå®ç°äº†çº¿ç´¢çŠ¶æ€å˜åŒ–å’Œæ–°çº¿ç´¢çš„å³æ—¶é€šçŸ¥ï¼Œå¹¶è®¾è®¡äº†å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚åŒæ—¶ï¼Œä½¿ç”¨SpeechSynthesisUtteranceå®ç°äº†è¯­éŸ³æ’­æŠ¥åŠŸèƒ½ã€‚
2ã€æ‰©å±•äº†proTableçš„valueEnumç±»å‹ï¼Œæ”¯æŒè‡ªå®šä¹‰ç»„ä»¶çš„å±•ç¤ºï¼Œå¢å¼ºäº†è¡¨æ ¼çš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§
3ã€æ¥å…¥å…¬å¸çš„ RBAC æƒé™ç®¡ç†å¹³å°ï¼Œå°è£… Access ç»„ä»¶ï¼Œæ–¹ä¾¿è¿›è¡Œæƒé™åˆ¤æ–­ï¼Œæ”¯æŒé¡µé¢æƒé™ä¸æŒ‰é’®æƒé™ï¼Œç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§
4ã€SSO è®¤è¯å¹³å°æ¥å…¥ï¼Œæ”¯æŒä¼ä¸šå¾®ä¿¡æ‰«ç ç™»å½•ï¼›åŒæ—¶ä¸ºäº†æ–¹ä¾¿å¼€å‘äººå‘˜ç™»å½•å…¶ä»–äººå‘˜è´¦å·ï¼Œå¼€å‘äº†ç›´æ¥ä½¿ç”¨ sso-name è¿›è¡Œç™»å½•ï¼Œæé«˜äº†é—®é¢˜æ’æŸ¥ä¸ä¿®å¤çš„æ•ˆç‡ ã€‚
5ã€é€šè¿‡é…ç½®Nginxï¼Œå°†åŸæœ¬çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰è½¬å˜ä¸ºå¤šé¡µåº”ç”¨ï¼ˆMPAï¼‰ ï¼Œå¹¶é€šè¿‡ iframe çš„æ–¹å¼åŠ è½½ç‚¹æ§äº‘æä¾›çš„ html æ–‡ä»¶ï¼Œé€šè¿‡postMessage æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œ å®ç°äº†ä¸ç¬¬ä¸‰æ–¹æœåŠ¡çš„é›†æˆã€‚
6ã€åŸºäº@ant-design/plotså°è£…äº†æŠ˜çº¿å›¾ç»„ä»¶ï¼Œæé«˜äº†å›¾è¡¨çš„å¯å¤ç”¨æ€§å’Œå¼€å‘æ•ˆç‡ã€‚
7ã€ä½¿ç”¨@umi/maxå†…ç½®çš„Modelä½œä¸ºçŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå­˜å‚¨å½“å‰çš„é€šè¯ä¿¡æ¯ï¼Œç®€åŒ–äº†çŠ¶æ€ç®¡ç†æµç¨‹
8ã€ä½¿ç”¨è…¾è®¯åœ°å›¾APIï¼Œå®ç°äº†å¯¹ä¸Šé—¨å›æ”¶å¸ˆä½ç½®çš„å®æ—¶ç›‘æ§å’Œè·¯å¾„è§„åˆ’ï¼Œæå‡äº†å¯¹å°å“¥çš„ç®¡æ§èƒ½åŠ›ã€‚



##### éš¾ç‚¹

- ç¬¬ä¸€æ¬¡å†™ react



##### websocket

1. **å…¨åŒå·¥é€šä¿¡**ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶ä¿¡æ¯ï¼Œè¿™ä¸ä¼ ç»Ÿçš„HTTPè¯·æ±‚ï¼ˆä¸€ç§åŠåŒå·¥é€šä¿¡æ–¹å¼ï¼‰å½¢æˆå¯¹æ¯”ï¼Œåœ¨HTTPä¸­ï¼Œè¯·æ±‚åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ï¼ŒæœåŠ¡å™¨å“åº”åè¿æ¥é€šå¸¸ä¼šå…³é—­ã€‚
2. **æŒä¹…è¿æ¥**ï¼šä¸€æ—¦WebSocketè¿æ¥å»ºç«‹ï¼Œå®ƒä¼šä¿æŒå¼€æ”¾çŠ¶æ€ï¼Œç›´åˆ°å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å†³å®šå…³é—­è¿æ¥ã€‚è¿™å‡å°‘äº†é¢‘ç¹å»ºç«‹è¿æ¥çš„å¼€é”€ã€‚
3. **ä½å»¶è¿Ÿ**ï¼šWebSocketè®¾è®¡ç”¨äºå‡å°‘é€šä¿¡è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿï¼Œå› ä¸ºå»ºç«‹è¿æ¥ä¹‹åï¼Œæ¶ˆæ¯å¯ä»¥ç›´æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½è¿›è¡Œæ¡æ‰‹ã€‚
4. **æ•°æ®å¸§**ï¼šWebSocketæ•°æ®é€šè¿‡å¸§ä¼ è¾“ï¼Œè¿™äº›å¸§å¯ä»¥ä»£è¡¨æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ•°æ®ã€‚
5. **å…¼å®¹æ€§**ï¼šWebSocketè®¾è®¡ä¸ºä¸ç°æœ‰çš„WebåŸºç¡€è®¾æ–½å…¼å®¹ã€‚å®ƒåœ¨HTTPçš„åŸºç¡€ä¸Šåˆå§‹åŒ–è¿æ¥ï¼Œé€šè¿‡å‘é€ä¸€ä¸ªç‰¹æ®Šçš„"Upgrade"è¯·æ±‚æ¥å°†HTTPè¿æ¥å‡çº§ä¸ºWebSocketè¿æ¥ã€‚



- SSE ä½¿ç”¨ HTTP åè®®ï¼Œç°æœ‰çš„æœåŠ¡å™¨è½¯ä»¶éƒ½æ”¯æŒã€‚WebSocket æ˜¯ä¸€ä¸ªç‹¬ç«‹åè®®ã€‚
- SSE å±äºè½»é‡çº§ï¼Œä½¿ç”¨ç®€å•ï¼›WebSocket åè®®ç›¸å¯¹å¤æ‚ã€‚
- SSE é»˜è®¤æ”¯æŒæ–­çº¿é‡è¿ï¼ŒWebSocket éœ€è¦è‡ªå·±å®ç°ã€‚
- SSE ä¸€èˆ¬åªç”¨æ¥ä¼ é€æ–‡æœ¬ï¼ŒäºŒè¿›åˆ¶æ•°æ®éœ€è¦ç¼–ç åä¼ é€ï¼ŒWebSocket é»˜è®¤æ”¯æŒä¼ é€äºŒè¿›åˆ¶æ•°æ®ã€‚
- SSE æ”¯æŒè‡ªå®šä¹‰å‘é€çš„æ¶ˆæ¯ç±»å‹ã€‚



httpã€websocketã€SSE éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

- **è¿æ¥æŒä¹…æ€§**ï¼šHTTPè¿æ¥é€šå¸¸æ˜¯çŸ­æš‚çš„ï¼Œè€ŒWebSocketå’ŒSSEéƒ½æ˜¯è®¾è®¡ä¸ºå»ºç«‹æŒä¹…è¿æ¥çš„ã€‚
- **åŒå‘é€šä¿¡**ï¼šWebSocketæ”¯æŒå…¨åŒå·¥é€šä¿¡ï¼Œè€ŒSSEåªæ”¯æŒæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„å•å‘é€šä¿¡ã€‚
- **å®æ—¶æ€§**ï¼šWebSocketå’ŒSSEéƒ½èƒ½æä¾›å®æ—¶æ•°æ®ä¼ è¾“ï¼Œä½†WebSocketæä¾›äº†æ›´é«˜çš„çµæ´»æ€§å’Œæ›´ä½çš„å»¶è¿Ÿã€‚
- **å¤æ‚æ€§å’Œèµ„æºæ¶ˆè€—**ï¼šWebSocketç›¸å¯¹äºSSEæ¥è¯´ï¼Œåœ¨æœåŠ¡å™¨ç«¯é€šå¸¸æ›´å¤æ‚ï¼Œå¯èƒ½éœ€è¦æ›´å¤šçš„èµ„æºæ¥ç»´æŠ¤æŒä¹…è¿æ¥å’ŒçŠ¶æ€ã€‚
- **æµè§ˆå™¨æ”¯æŒ**ï¼šå¤§å¤šæ•°



```js
var ws;
var heartbeatInterval = 10000; // å¿ƒè·³é—´éš”æ—¶é—´ï¼Œä¾‹å¦‚10ç§’
var heartbeatTimeout = 2000; // å¿ƒè·³å“åº”è¶…æ—¶æ—¶é—´ï¼Œä¾‹å¦‚2ç§’
var reconnectInterval = 5000; // é‡è¿é—´éš”æ—¶é—´ï¼Œä¾‹å¦‚5ç§’
var heartbeatTimer = null;
var heartbeatTimeoutTimer = null;

function connect() {
  ws = new WebSocket('wss://example.com/socketserver');

  ws.onopen = function(event) {
    console.log('Connection opened');
    startHeartbeat();
  };

  ws.onmessage = function(event) {
    console.log('Received message: ' + event.data);
    // å¦‚æœæ”¶åˆ°ä»»ä½•æ¶ˆæ¯ï¼Œè¯´æ˜è¿æ¥æ˜¯æ´»è·ƒçš„ï¼Œé‡ç½®å¿ƒè·³
    resetHeartbeat();
  };

  ws.onerror = function(event) {
    console.error('WebSocket error observed:', event);
  };

  ws.onclose = function(event) {
    console.log('Connection closed');
    stopHeartbeat();
    // å°è¯•é‡æ–°è¿æ¥
    setTimeout(connect, reconnectInterval);
  };
}

function startHeartbeat() {
  heartbeatTimer = setInterval(function() {
    console.log('Sending heartbeat');
    ws.send('HEARTBEAT');

    // å¦‚æœåœ¨è®¾å®šçš„è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œè®¤ä¸ºè¿æ¥å·²æ–­å¼€
    heartbeatTimeoutTimer = setTimeout(function() {
      console.log('Heartbeat timeout, closing connection');
      ws.close(); // ä¸»åŠ¨å…³é—­è¿æ¥
    }, heartbeatTimeout);
  }, heartbeatInterval);
}

function resetHeartbeat() {
  // æ¸…é™¤è¶…æ—¶å®šæ—¶å™¨ï¼Œå¹¶é‡æ–°å¼€å§‹å¿ƒè·³
  clearTimeout(heartbeatTimeoutTimer);
  heartbeatTimeoutTimer = null;
}

function stopHeartbeat() {
  clearInterval(heartbeatTimer);
  clearTimeout(heartbeatTimeoutTimer);
  heartbeatTimer = null;
  heartbeatTimeoutTimer = null;
}

// åˆå§‹åŒ–è¿æ¥
connect();

```





##### SSO

> https://juejin.cn/post/7195588906809032764

1. **ç¬¬ä¸€æ¬¡è®¿é—®ç³»ç»ŸA**ï¼š

   - **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·è®¿é—®ç³»ç»ŸAï¼ˆ`www.app1.com`ï¼‰ï¼Œç”±äºå°šæœªç™»å½•ï¼Œç³»ç»ŸAå°†ç”¨æˆ·é‡å®šå‘åˆ°è®¤è¯ä¸­å¿ƒï¼ˆ`www.sso.com`ï¼‰ã€‚
   - **è®¤è¯ä¸­å¿ƒæ“ä½œ**ï¼š
     - ç”¨æˆ·åœ¨è®¤è¯ä¸­å¿ƒè¾“å…¥ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ã€‚
     - ç™»å½•æˆåŠŸåï¼Œè®¤è¯ä¸­å¿ƒåœ¨å…¶åŸŸåä¸‹ï¼ˆ`www.sso.com`ï¼‰ç§ä¸‹`cookieSSO`ï¼Œç”¨äºè®°å½•ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚
     - è®¤è¯ä¸­å¿ƒç”Ÿæˆä¸€ä¸ª`ticket`ï¼Œå¹¶å°†ç”¨æˆ·é‡å®šå‘å›ç³»ç»ŸAï¼ˆ`www.app1.com?ticket=xxx`ï¼‰ã€‚
   - **ç³»ç»ŸAæ“ä½œ**ï¼š
     - ç³»ç»ŸAæ”¶åˆ°å¸¦æœ‰`ticket`çš„è¯·æ±‚ï¼Œåç«¯`serverA`ä½¿ç”¨`ticket`å‘è®¤è¯ä¸­å¿ƒ`serverSSO`éªŒè¯ç”¨æˆ·èº«ä»½ã€‚
     - éªŒè¯é€šè¿‡åï¼Œç³»ç»ŸAåœ¨å…¶åŸŸåä¸‹ï¼ˆ`www.app1.com`ï¼‰ç§ä¸‹`cookieA`ï¼Œç”¨äºç»´æŠ¤ç”¨æˆ·åœ¨ç³»ç»ŸAçš„ä¼šè¯ã€‚

2. **ç¬¬äºŒæ¬¡è®¿é—®ç³»ç»ŸA**ï¼š

   - **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·å†æ¬¡è®¿é—®ç³»ç»ŸAã€‚
   - **ç³»ç»ŸAæ“ä½œ**ï¼š
     - æµè§ˆå™¨ä¼šè‡ªåŠ¨æºå¸¦`cookieA`ã€‚
     - ç³»ç»ŸAçš„åç«¯éªŒè¯`cookieA`ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œç”¨æˆ·æ— éœ€å†æ¬¡ç™»å½•å³å¯ç›´æ¥è®¿é—®ç³»ç»ŸAã€‚

3. **ç¬¬ä¸‰æ¬¡è®¿é—®ç³»ç»ŸB**ï¼š

   - **ç”¨æˆ·æ“ä½œ**ï¼šç”¨æˆ·è®¿é—®ç³»ç»ŸBï¼ˆ`www.app2.com`ï¼‰ã€‚
   - **ç³»ç»ŸBæ“ä½œ**ï¼šç”±äºç”¨æˆ·æœªåœ¨ç³»ç»ŸBç™»å½•ï¼Œç³»ç»ŸBå°†ç”¨æˆ·é‡å®šå‘åˆ°è®¤è¯ä¸­å¿ƒï¼ˆ`www.sso.com`ï¼‰ã€‚
   - **è®¤è¯ä¸­å¿ƒæ“ä½œ**ï¼š
     - æµè§ˆå™¨ä¼šæºå¸¦ä¹‹å‰åœ¨è®¤è¯ä¸­å¿ƒç§ä¸‹çš„`cookieSSO`ã€‚
     - è®¤è¯ä¸­å¿ƒæ£€æµ‹åˆ°`cookieSSO`æœ‰æ•ˆï¼Œç¡®è®¤ç”¨æˆ·å·²ç™»å½•ï¼Œæ— éœ€å†æ¬¡è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚
     - è®¤è¯ä¸­å¿ƒç”Ÿæˆä¸€ä¸ªæ–°çš„`ticket`ï¼Œå¹¶å°†ç”¨æˆ·é‡å®šå‘å›ç³»ç»ŸBï¼ˆ`www.app2.com?ticket=xxx`ï¼‰ã€‚
   - **ç³»ç»ŸBæ“ä½œ**ï¼š
     - ç³»ç»ŸBæ”¶åˆ°å¸¦æœ‰`ticket`çš„è¯·æ±‚ï¼Œåç«¯`serverB`ä½¿ç”¨`ticket`å‘è®¤è¯ä¸­å¿ƒ`serverSSO`éªŒè¯ç”¨æˆ·èº«ä»½ã€‚
     - éªŒè¯é€šè¿‡åï¼Œç³»ç»ŸBåœ¨å…¶åŸŸåä¸‹ï¼ˆ`www.app2.com`ï¼‰ç§ä¸‹`cookieB`ï¼Œç”¨äºç»´æŠ¤ç”¨æˆ·åœ¨ç³»ç»ŸBçš„ä¼šè¯ã€‚

**æ³¨æ„äº‹é¡¹**ï¼š

- **Cookieçš„ä½œç”¨åŸŸ**ï¼š
  - `cookieSSO`ï¼šåªåœ¨è®¤è¯ä¸­å¿ƒçš„åŸŸåï¼ˆ`www.sso.com`ï¼‰ä¸‹æœ‰æ•ˆï¼Œç”¨äºæ ‡è¯†ç”¨æˆ·åœ¨è®¤è¯ä¸­å¿ƒçš„ç™»å½•çŠ¶æ€ã€‚
  - `cookieA`å’Œ`cookieB`ï¼šåˆ†åˆ«åœ¨ç³»ç»ŸAå’Œç³»ç»ŸBçš„åŸŸåä¸‹æœ‰æ•ˆï¼Œç”¨äºç»´æŠ¤ç”¨æˆ·åœ¨å„è‡ªç³»ç»Ÿä¸­çš„ä¼šè¯çŠ¶æ€ã€‚

- **Ticketçš„ä½¿ç”¨**ï¼š
  - `ticket`æ˜¯ä¸€æ¬¡æ€§ä»¤ç‰Œï¼Œé€šå¸¸åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œå…·æœ‰çŸ­æš‚çš„æœ‰æ•ˆæœŸã€‚
  - ç³»ç»ŸAå’Œç³»ç»ŸBåœ¨æ”¶åˆ°`ticket`åï¼Œéœ€ç«‹å³å‘è®¤è¯ä¸­å¿ƒéªŒè¯ï¼Œå¹¶åœ¨æœ¬åœ°å»ºç«‹ä¼šè¯ã€‚

æ‚¨çš„ç†è§£å‡†ç¡®åœ°æè¿°äº†CASå•ç‚¹ç™»å½•çš„æ ¸å¿ƒæµç¨‹ã€‚



##### RBAC

åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼š é€šè¿‡è§’è‰²å…³è”ç”¨æˆ·ï¼Œè§’è‰²å…³è”æƒé™çš„æ–¹å¼é—´æ¥èµ‹äºˆç”¨æˆ·æƒé™

RBACé€šè¿‡å®šä¹‰è§’è‰²çš„æƒé™ï¼Œå¹¶å¯¹ç”¨æˆ·æˆäºˆæŸä¸ªè§’è‰²ä»è€Œæ¥æ§åˆ¶ç”¨æˆ·çš„æƒé™ï¼Œå®ç°äº†ç”¨æˆ·å’Œæƒé™çš„é€»è¾‘åˆ†ç¦»

- ğŸ§‘â€ğŸ’» **Userï¼ˆç”¨æˆ·ï¼‰** - æ¯ä¸ªç”¨æˆ·éƒ½æœ‰å”¯ä¸€çš„UIDè¯†åˆ«ï¼Œå¹¶è¢«æˆäºˆä¸åŒçš„è§’è‰²

- ğŸ¤¹ **Roleï¼ˆè§’è‰²ï¼‰** - ä¸åŒè§’è‰²å…·æœ‰ä¸åŒçš„æƒé™

- ğŸ›  **Permissionï¼ˆæƒé™ï¼‰** - è®¿é—®æƒé™

- ğŸ“¤ **ç”¨æˆ·-è§’è‰²æ˜ å°„** - ç”¨æˆ·å’Œè§’è‰²ä¹‹é—´çš„æ˜ å°„å…³ç³»

- ğŸ“ **è§’è‰²-æƒé™æ˜ å°„** - è§’è‰²å’Œæƒé™ä¹‹é—´çš„æ˜ å°„



åˆ†ç±»ï¼š 

- RBAC0-åŸºç¡€
- RBAC1-è§’è‰²ç»§æ‰¿ï¼Œæ¯”å¦‚éƒ¨é—¨è´Ÿè´£äººã€å°ç»„é•¿
- RBAC2-è§’è‰²æƒé™é™åˆ¶ï¼Œå”¯ä¸€æ€§ã€äº’æ–¥æ€§ï¼Œæ¯”å¦‚ï¼šéƒ¨é—¨åªæœ‰ä¸€ä¸ªè€å¤§ï¼Œ
- RBAC3 æ•´åˆäº†å‰é¢çš„å‡ ç§ï¼Œæ¯”å¦‚ å…¬å¸ç»„ç»‡æ¶æ„



åŸºäºèµ„æºçš„æƒé™è®¿é—®æ§åˆ¶æ¨¡å‹ï¼ˆResource-Based-Access-Controlï¼‰ å°±æµè¡Œäº†èµ·æ¥ï¼Œåœ¨ä¼ ç»Ÿæ¨¡å‹åŸºç¡€ä¸Šï¼Œå®ƒè®©ç”¨æˆ·ä¹Ÿå¯ä»¥ç›´æ¥å…³è”æƒé™ï¼Œè¿™æ ·å°±æ›´åŠ çµæ´»äº†ã€‚



##### è‡ªå®šä¹‰valueTypeç±»å‹

###### è‡ªå®šä¹‰æ¸²æŸ“

ä½¿ç”¨renderFormItemå‡½æ•°è¿”å›è‡ªå®šä¹‰ç»„ä»¶ï¼Œåœ¨å…¶ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­è·å–åˆ°formå®ä¾‹ï¼Œä½¿ç”¨`form.setFieldsValue({ evaluatePriceInSearch: [] });` è®¾ç½®åˆå§‹å€¼ï¼Œä¸ç„¶searchçš„transformæ–¹æ³•åœ¨æœç´¢çš„æ—¶å€™ä¸ç”Ÿæ•ˆï¼Œtableè¿˜éœ€è¦ç›‘å¬`onReset` ï¼Œ åœ¨é‡ç½®æ—¶å€™å–æ¶ˆç­›é€‰æ¡ä»¶

```js
import React, { useState } from 'react';
import ProTable from '@ant-design/pro-table';
import { InputNumber, Form } from 'antd';

const InputRange = ({ value, onChange }) => (
  <Form.Item label="ä¼°ä»·èŒƒå›´">
    <InputNumber
      value={value[0]}
      onChange={val => onChange([val, value[1]])}
      style={{ marginRight: 8 }}
    />
    åˆ°
    <InputNumber
      value={value[1]}
      onChange={val => onChange([value[0], val])}
      style={{ marginLeft: 8 }}
    />
  </Form.Item>
);

const DemoTable = () => {
  const [form] = Form.useForm();
  const [evaluatePriceRange, setEvaluatePriceRange] = useState([]);

  const columns = [
    {
      title: 'ä¼°ä»·é‡‘é¢',
      hideInTable: true,
      dataIndex: 'evaluatePriceInSearch',
      order: 30,
      search: {
        transform: () => ({
          minEvaluatePrice: evaluatePriceRange[0] ?? '',
          maxEvaluatePrice: evaluatePriceRange[1] ?? '',
        }),
      },
      renderFormItem: (_, { type, defaultRender, ...rest }, form) => {
        if (type === 'form') {
          // åªæœ‰åœ¨è¡¨å•ä¸­æ‰å¤„ç†
          return (
            <InputRange
              value={evaluatePriceRange}
              onChange={value => {
                setEvaluatePriceRange(value);
                // æ›´æ–°è¡¨å•å­—æ®µå€¼ï¼Œä»¥ä¿è¯ä¸ ProTable æŸ¥è¯¢å‚æ•°åŒæ­¥
                form.setFieldsValue({ evaluatePriceInSearch: value });
              }}
            />
          );
        }
        return defaultRender(_);
      },
    },
    // å…¶ä»–åˆ—é…ç½®...
  ];

  return (
    <ProTable
      columns={columns}
      request={async (params) => {
        // æ¨¡æ‹Ÿè¯·æ±‚æ•°æ®
        console.log(params);
        return Promise.resolve({
          data: [],
          success: true,
        });
      }}
      rowKey="id"
      form={form}
      search={{
        filterType: 'light',
      }}
    />
  );
};

export default DemoTable;
```



###### æ‰©å±•

```js
// App.tsx
import React from 'react';
import { ProProvider, ProTable } from '@ant-design/pro-components';
import CustomComponent from './CustomComponent';

const valueTypeMap = {
  custom: {
    render: (text, props) => {
      return <CustomComponent value={text} {...props} />;
    },
    renderFormItem: (text, props, form) => {
      return <CustomComponent {...props} />;
    },
  },
};

const columns = [
  {
    title: 'è‡ªå®šä¹‰å­—æ®µ',
    dataIndex: 'customField',
    valueType: 'custom',
  },
  // å…¶ä»–åˆ—é…ç½®...
];

const App: React.FC = () => {
  return (
    <ProProvider value={{ valueTypeMap }}>
      <ProTable columns={columns} />
    </ProProvider>
  );
};

export default App;

```





##### è…¾è®¯åœ°å›¾

```js
// 1ã€å…ˆè¿›è¡Œæ ‡ç‚¹ï¼Œæ ‡å‡ºç”¨æˆ·çš„åœ°å€  
 const marker = new TMap.MultiMarker({
      id: 'marker-layer-' + randomStr, // ä¸ºæ¯ä¸ªæ ‡è®°å›¾å±‚æŒ‡å®šå”¯ä¸€çš„ID
      map: map,
      styles: {},
      geometries: [
        {
          id: 'marker-' + randomStr, // ä¸ºæ¯ä¸ªæ ‡è®°æŒ‡å®šå”¯ä¸€çš„ID
          styleId: 'marker',
          position: new TMap.LatLng(lat, lng),
        },
      ],
    })
// 2ã€è¿›è¡Œè·¯å¾„è§„åˆ’å’Œè·¯å¾„ç»˜åˆ¶
  const _myPath = new TMap.MultiPolyline({
        id: 'polyline-layer' + randomStr, //å›¾å±‚å”¯ä¸€æ ‡è¯†
        map, //ç»˜åˆ¶åˆ°ç›®æ ‡åœ°å›¾
        //æŠ˜çº¿æ ·å¼å®šä¹‰
        styles: { },
        //æŠ˜çº¿æ•°æ®å®šä¹‰
        geometries: [
          {
            id: 'pl_1', //æŠ˜çº¿å”¯ä¸€æ ‡è¯†ï¼Œåˆ é™¤æ—¶ä½¿ç”¨
            styleId: 'style_blue', //ç»‘å®šæ ·å¼å
            paths: pl,
          },
        ],
      })
// 3ã€æ›´æ–°åœ°å›¾çš„ä¸­å¿ƒç‚¹ä½ä¸Šé—¨å°å“¥å½“å‰çš„ä½ç½®ä¿¡æ¯
   function changeMapCenter(lat: number, lng: number) {
    const newCenter = new TMap.LatLng(lat, lng);
    map.setCenter(newCenter);
  }
// 4ã€æ ‡å‡ºå°å“¥å½“å‰çš„ä½ç½®
new TMap.MultiMarker
_addMarker({
      lat: props.doormanLocation.lat,
      lng: props.doormanLocation.lng,
      content: `
        <div>
          <p>ä¸Šé—¨æ—¶é—´ï¼š ${moment(new Date().getTime()).format('YYYY-MM-DD HH:mm:ss')}</p>
          <p>ä¸Šé—¨åœ°å€ï¼š ${props.doormanLocation.address}</p>
        </div>
      `,
      src: 'https://pic4.zhuanstatic.com/zhuanzh/77ea3d91-8ef7-49b0-a827-48bc2b3092ea.png',
    })
```



##### æŠ˜çº¿å›¾å°è£…

åå°ä¸­çš„å›¾æ ‡æ ·å¼åŸºæœ¬ä¸Šéƒ½ä¸€æ ·ï¼Œæ‰€ä»¥è¿›è¡Œäº†å°è£…ï¼Œç›´æ¥å°†æ¥å£ä¸­çš„æ•°æ®ä¸¢è¿›å»å°±è¡Œã€‚

```js
import { Line } from '@ant-design/plots'
import React from 'react'

interface LineProps {
  data: any
}

const LineComp: React.FC<LineProps> = (props) => {
  let data = props.data

  // æ‰¾å‡ºæœ€å¤§å€¼å’Œæœ€å°å€¼
  const maxVal = Math.max(...data.map((item: any) => item.value))
  const minVal = Math.min(...data.map((item: any) => item.value))

  const computedPadding = () => {
    return [18, props.data.length > 7 ? 50 : 24]
  }

  const config = {
    data,
    // padding: [18, 12, 18, 26], // ä¸Š å³ ä¸‹ å·¦ çš„å†…è¾¹è·
    // padding: [18, 18], // ä¸Š å³ ä¸‹ å·¦ çš„å†…è¾¹è·
    padding: computedPadding(), // ä¸Š å³ ä¸‹ å·¦ çš„å†…è¾¹è·
    xField: 'date',
    yField: 'value',
    xAxis: {
      tickLine: null, // ä¸æ˜¾ç¤ºè½´ä¸Šçš„åˆ»åº¦çº¿
      line: null, // ä¸æ˜¾ç¤ºè½´çº¿
      // é…ç½® X è½´æ ‡ç­¾
      label: {
        // å¯ä»¥é€šè¿‡ formatter è‡ªå®šä¹‰æ ‡ç­¾çš„æ˜¾ç¤ºæ ¼å¼
        formatter: (text: any, item: any, index: any) => {
          // åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ ‡ç­¾
          if (index === 0 || index === data.length - 1) {
            return text
          }
          return ''
        },
      },
    },
    yAxis: {
      visible: false, // éšè— Y è½´
      grid: {
        visible: false,
      },
    },
    area: {
      visible: true, // æ˜¾ç¤ºåŒºåŸŸå¡«å……
      style: {
        fill: 'l(90) 0:#5B8FF9 1:#ffffff', // ä»ä¸Šåˆ°ä¸‹çš„æ¸å˜
        fillOpacity: 0.1,
      },
    },
    point: {
      visible: true,
      shape: 'circle',
      style: (item: any) => {
        const isMaxOrMin = item.value === maxVal || item.value === minVal
        return {
          r: (isMaxOrMin && item.value !== 0) ? 2 : 0, // åªä¸ºæœ€å¤§å€¼å’Œæœ€å°å€¼è®¾ç½®åŠå¾„
          fill: isMaxOrMin ? 'white' : 'transparent',
          stroke: isMaxOrMin ? '#5B8FF9' : 'transparent',
          lineWidth: isMaxOrMin ? 2 : 0,
        }
      },
    },
    label: {
      visible: true,
      offset: -15, // æ ‡ç­¾ä¸ç‚¹çš„å‚ç›´åç§»é‡
      adjustColor: false, // ç¡®ä¿ä¸ä¼šè‡ªåŠ¨è°ƒæ•´æ–‡æœ¬é¢œè‰²
      style: {
        fill: '#666', // å­—ä½“é¢œè‰²
        fontSize: 10,
        fontWeight: 'bold',
        textAlign: 'center',
        textBaseline: 'middle',
        // èƒŒæ™¯æ ·å¼
        background: {
          padding: [2, 4], // æ–‡å­—å‘¨å›´çš„å†…è¾¹è·ï¼Œå¯é€‚å½“è°ƒæ•´
          fill: '#fff', // èƒŒæ™¯å¡«å……é¢œè‰²
          stroke: '#666', // è¾¹æ¡†é¢œè‰²
          radius: 2, // è¾¹æ¡†åœ†è§’
        },
      },
      // ä½¿ç”¨ formatter æ¥æ˜¾ç¤ºæ•°æ®ç‚¹çš„å€¼
      formatter: (text: any, item: any) => {
        // item å‚æ•°ä»£è¡¨æ•°æ®ç‚¹ï¼Œå…¶ç»“æ„ä¸ data æ•°ç»„ä¸­çš„å¯¹è±¡ä¸€è‡´
        const isMaxOrMin = item._origin.value === maxVal || item._origin.value === minVal
        return isMaxOrMin ? `${item._origin.value === 0 ? '' : item._origin.value}` : ''
      },
    },
    tooltip: {
      visible: true, // æ˜¾ç¤ºæç¤ºä¿¡æ¯
    },
    line: {
      smooth: true, // æ›²çº¿å¹³æ»‘
    },
    smooth: true,
  }

  // @ts-ignore
  return <Line {...config} />
}

export default LineComp
```







##### æ•°æ®æµ



##### React Hooks





#### **zzCoder**


zzCoder æ˜¯ä¸€æ¬¾æ—¨åœ¨æé«˜å¼€å‘æ•ˆç‡å’Œä½“éªŒçš„ VSCode æ’ä»¶ã€‚å®ƒæä¾›äº†å¯¹åŸºç¡€åº“ï¼ˆå¦‚ç§»åŠ¨ç«¯ç»„ä»¶åº“ zzuiã€React ç»„ä»¶åº“ zant uiï¼‰çš„æ”¯æŒï¼Œç»Ÿä¸€å›¢é˜Ÿçš„å¸¸ç”¨åŠŸèƒ½ä»£ç ç‰‡æ®µå’Œé¡µé¢æ¨¡æ¿ï¼Œå¹¶å…·å¤‡ç¿»è¯‘åŠŸèƒ½ã€‚æ­¤å¤–ï¼ŒzzCoder è¿˜é›†æˆäº† AI èƒ½åŠ›ï¼ŒåŒ…æ‹¬ä»£ç ç”Ÿæˆã€ä¼˜åŒ–ã€é‡æ„ã€ç”Ÿæˆå‡½æ•°åç§°å’Œæ·»åŠ æµ‹è¯•ç­‰åŠŸèƒ½ã€‚AI ç›¸å…³åŠŸèƒ½ç”±åŸºç¡€æ”¯æ’‘ç»„ä½¿ç”¨ ollama æœ¬åœ°éƒ¨ç½²çš„ codegeex4-all-9b æ¨¡å‹æä¾›æœåŠ¡æ”¯æŒã€‚


1ã€ä½¿ç”¨ VSCode æä¾›çš„ API registerCompletionItemProvider å®ç°æŒ‰ä¸‹ <z- è§¦å‘ç»„ä»¶æç¤ºï¼Œå¹¶é…åˆ command å±æ€§ï¼Œåœ¨é€‰ä¸­æ—¶è‡ªåŠ¨è¿›è¡Œç»„ä»¶çš„å¯¼å…¥å’Œä½¿ç”¨ã€‚
2ã€é€šè¿‡é…ç½® package.json çš„ snippets å±æ€§ï¼Œæ”¯æŒåœ¨ä¸åŒçš„æ–‡ä»¶ç±»å‹ä¸­åŠ è½½ä¸åŒçš„ä»£ç ç‰‡æ®µï¼Œæé«˜äº†ä»£ç çš„å¤ç”¨æ€§å’Œå¼€å‘æ•ˆç‡ã€‚
3ã€é…ç½®å³é”®èœå•æ‰§è¡Œå‘½ä»¤ï¼ŒåŠ¨æ€ç”Ÿæˆå¤šä¸ªä»£ç ç‰‡æ®µï¼Œç®€åŒ–äº†ä»£ç çš„åˆ›å»ºè¿‡ç¨‹ï¼Œè¿›ä¸€æ­¥æé«˜äº†å¼€å‘æ•ˆç‡ã€‚
4ã€å°è£…äº† jsBridge ä»¥å®ç° webview å’Œ vscode ä¹‹é—´çš„é€šä¿¡ï¼Œå…è®¸ä»£ç ç”Ÿæˆåç›´æ¥æ’å…¥åˆ° vscodeï¼Œæé«˜äº†å¼€å‘ä½“éªŒ
5ã€é€šè¿‡ WebviewViewProvider.resolveWebviewView API åœ¨ä¾§è¾¹æ æ‰“å¼€ webviewï¼Œæ–¹ä¾¿å¿«æ·åœ°è®¿é—®å’Œä½¿ç”¨ã€‚
6ã€åŸºäºæ’ä»¶åŒ–å®ç°ç¿»è¯‘åŠŸèƒ½ï¼Œå¢å¼ºäº†ç¿»è¯‘èƒ½åŠ›çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚

 

##### éš¾ç‚¹

- 



##### CPU å’Œ GPU æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆå¤§æ¨¡å‹éœ€è¦ä¾èµ– GPU

CPUï¼ˆä¸­å¤®å¤„ç†å™¨ï¼‰å’Œ GPUï¼ˆå›¾å½¢å¤„ç†å™¨ï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ä¸¤ç§å…³é”®ç»„ä»¶ï¼Œä½†å®ƒä»¬åœ¨è®¾è®¡ç›®æ ‡ã€ç»“æ„å’Œåº”ç”¨é¢†åŸŸä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚

**CPU çš„ç‰¹ç‚¹ï¼š**

1. **é€šç”¨æ€§å¼º**ï¼šCPU è¢«è®¾è®¡ä¸ºèƒ½å¤Ÿå¤„ç†å„ç§ä¸åŒç±»å‹çš„ä»»åŠ¡ï¼Œé€‚ç”¨äºæ‰§è¡Œå¤æ‚çš„é€»è¾‘è¿ç®—å’Œå†³ç­–ã€‚
2. **æ ¸å¿ƒæ•°é‡å°‘ï¼Œé¢‘ç‡é«˜**ï¼šä¼ ç»Ÿçš„ CPU æ‹¥æœ‰å°‘é‡çš„é«˜æ€§èƒ½æ ¸å¿ƒï¼Œè¿è¡Œé¢‘ç‡è¾ƒé«˜ï¼Œé€‚åˆé¡ºåºå¤„ç†ä»»åŠ¡ã€‚
3. **æ“…é•¿ä¸²è¡Œè®¡ç®—**ï¼šCPU åœ¨å¤„ç†éœ€è¦ä¾æ¬¡æ‰§è¡Œçš„ä»»åŠ¡æ—¶è¡¨ç°å‡ºè‰²ï¼Œä½†åœ¨å¤§é‡å¹¶è¡Œè®¡ç®—æ–¹é¢æ•ˆç‡è¾ƒä½ã€‚

**GPU çš„ç‰¹ç‚¹ï¼š**

1. **å¹¶è¡Œè®¡ç®—èƒ½åŠ›å¼º**ï¼šGPU æ‹¥æœ‰å¤§é‡çš„è®¡ç®—æ ¸å¿ƒï¼Œå¯ä»¥åŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡çš„çº¿ç¨‹ï¼Œé€‚åˆå¤§é‡å¹¶è¡Œè¿ç®—ã€‚
2. **ä¼˜åŒ–æ•°æ®ååé‡**ï¼šGPU è®¾è®¡æ—¨åœ¨æé«˜æ•°æ®å¤„ç†çš„ååé‡ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å›¾å½¢å’ŒçŸ©é˜µè®¡ç®—æ—¶è¡¨ç°ä¼˜å¼‚ã€‚
3. **é€‚åˆç®€å•ã€é‡å¤çš„è®¡ç®—ä»»åŠ¡**ï¼šGPU åœ¨æ‰§è¡Œå¤§é‡ç›¸åŒæˆ–ç±»ä¼¼çš„è®¡ç®—æ—¶æ•ˆç‡æé«˜ï¼Œä¾‹å¦‚çŸ©é˜µä¹˜æ³•å’Œå‘é‡è¿ç®—ã€‚

**ä¸ºä»€ä¹ˆå¤§æ¨¡å‹éœ€è¦ä¾èµ– GPUï¼š**

å¤§æ¨¡å‹ï¼Œå°¤å…¶æ˜¯åœ¨æ·±åº¦å­¦ä¹ å’Œäººå·¥æ™ºèƒ½é¢†åŸŸçš„æ¨¡å‹ï¼Œé€šå¸¸æ¶‰åŠå¤§é‡çš„çŸ©é˜µå’Œå‘é‡è¿ç®—ã€‚è¿™äº›è¿ç®—å¯ä»¥è¢«åˆ†è§£ä¸ºå¤§é‡çš„ç®€å•ã€ç‹¬ç«‹çš„è®¡ç®—ä»»åŠ¡ï¼Œé€‚åˆå¹¶è¡Œå¤„ç†ã€‚

1. **åŠ é€Ÿè®­ç»ƒè¿‡ç¨‹**ï¼šGPU çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›å¯ä»¥å¤§å¹…æé«˜æ¨¡å‹è®­ç»ƒçš„é€Ÿåº¦ï¼Œå°†åŸæœ¬å¯èƒ½éœ€è¦æ•°å‘¨çš„è®­ç»ƒæ—¶é—´ç¼©çŸ­è‡³å‡ å¤©ç”šè‡³å‡ å°æ—¶ã€‚
2. **å¤„ç†å¤§è§„æ¨¡æ•°æ®**ï¼šå¤§æ¨¡å‹éœ€è¦å¤„ç†æµ·é‡çš„æ•°æ®é›†ï¼ŒGPU çš„é«˜å¸¦å®½å†…å­˜å’Œå¿«é€Ÿæ•°æ®ä¼ è¾“èƒ½åŠ›ä½¿å…¶èƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†è¿™äº›æ•°æ®ã€‚
3. **æ”¯æŒå¤æ‚çš„è®¡ç®—æ“ä½œ**ï¼šGPU èƒ½å¤Ÿé«˜æ•ˆåœ°æ‰§è¡Œæ·±åº¦å­¦ä¹ æ‰€éœ€çš„å¤§é‡çŸ©é˜µå’Œå‘é‡è¿ç®—ï¼Œè¿™å¯¹äºè®­ç»ƒæ·±å±‚ç¥ç»ç½‘ç»œè‡³å…³é‡è¦ã€‚
4. **è½¯ä»¶ç”Ÿæ€æ”¯æŒ**ï¼šè®¸å¤šæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆå¦‚ TensorFlowã€PyTorchï¼‰éƒ½é’ˆå¯¹ GPU è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæä¾›äº†ä¾¿æ·çš„æ¥å£å’Œå·¥å…·ï¼Œè¿›ä¸€æ­¥æå‡äº† GPU çš„ä¼˜åŠ¿ã€‚



##### å†…è”æ¨è

```js
const provider: vscode.InlineCompletionItemProvider = {
    async provideInlineCompletionItems(document, position, context, token) {
        // æä¾›å†…è”è¡¥å…¨é¡¹çš„é€»è¾‘
    },
    handleDidShowCompletionItem(completionItem) {
        console.log('handleDidShowCompletionItem');
    },
    handleDidPartiallyAcceptCompletionItem(completionItem, info) {
        console.log('handleDidPartiallyAcceptCompletionItem');
    },
};

```



##### JSbridge

> é˜Ÿåˆ—ç¼“å­˜æ¶ˆæ¯



vscode ç«¯

```js
// å¼€å¯ç›‘å¬
public startListen() {
  this.webview.onDidReceiveMessage((message: MessageType) => {
    console.log('æ”¶åˆ°æ¥è‡ª webview çš„æ¶ˆæ¯', message);

    // æ‰¾åˆ°éœ€è¦è°ƒç”¨çš„å‡½æ•°
    const fn = this.messageHandler[message.method]

    // å‡½æ•°å­˜åœ¨å°±è°ƒç”¨
    if (fn && typeof fn === 'function') {
      fn(message)
    } else {
      showError(`è¯¥ç«¯æœªå®ç° ${message.method} æ–¹æ³•ï¼`);
    }

  });
}

  /**
   * @description: å‘ webview å‘é€æ¶ˆæ¯
   * @param {string} method webviewé¡µé¢é‡Œé¢çš„æ–¹æ³•åç§°ï¼Œå³éœ€è¦è°ƒç”¨ webview é¡µé¢é‡Œçš„å“ªä¸ªæ–¹æ³•
   * @param {any} data è°ƒç”¨ webview é¡µé¢æ–¹æ³•æ—¶ä¼ å…¥çš„å‚æ•°
   * @return {*}
   */
  public sendMsgToWebview(method: string, data?: any) {
    if (this.webview) {
      const msg: MessageType = {
        from: 'vscode',
        msgId: getMsgId(),
        method,
        data
      }
      this.webview.postMessage(msg);
    } else {
      console.log('sendMsgToWebview -- webview ä¸å­˜åœ¨');
    }
  }
```



webview ç«¯

```js
 /**
   * @description: æ·»åŠ äº‹ä»¶ç›‘å¬
   * @param {function} callback äº‹ä»¶ç›‘å¬å¤„ç†å‡½æ•°
   * @return {*}
   */
  addListener(callback: (data: any) => void): void {
    const listener: EventListener = (event: any): void => {
      if (event.origin !== window.location.origin)
        return
      // è¿™é‡Œéœ€è¦ç»‘å®š this ï¼Œ å¦åˆ™åœ¨ handleVscodeMsg ä¸­æ— æ³•ä½¿ç”¨ this.callbacks è·å–åˆ° callbacks
      callback.call(this, event)
    }

    window.addEventListener('message', listener)
    this.listeners.push({ callback, listener })
  }
  
/**
   * @description: å¤„ç†æ¥è‡ª vscode æ’ä»¶çš„æ¶ˆæ¯
   * @param {Event} event
   * @return {*}
   */
  handleVscodeMsg(event: Event) {
    console.log('æ¥è‡ª vscode æ’ä»¶çš„æ¶ˆæ¯-->event', event)
    // ç›‘å¬ vscode å‘æ¥çš„æ¶ˆæ¯ï¼Œ data æ˜¯çº¦å®šå¥½çš„æ•°æ®ç»“æ„
    const message = (event as any).data as MessageType

    // åªå¤„ç† vscode æ’ä»¶å‘è¿‡æ¥çš„ message æ¶ˆæ¯ï¼Œé˜²æ­¢ä¸åœ¨vscodeæ’ä»¶çš„ webview ä¸­ï¼Œwindow ä¸Šè¿˜æœ‰ acquireVsCodeApi æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬ä¸ä¼šå‡ºç°
    if (message.from === 'vscode') {
      // æ ¹æ® msgId è·å–åˆ°å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœå­˜åœ¨å°±æ‰§è¡Œ
      // msgId å’Œå¯¹åº”çš„å›è°ƒå‡½æ•°ä¼šåœ¨ callVscode æ–¹æ³•è¿›è¡Œä¿å­˜
      // this.callbacks[message.msgId]: webview é¡µé¢ ä¸»åŠ¨è°ƒç”¨ vscode æ’ä»¶çš„æ–¹æ³•
      // this.callbacks[message.method]: vscodeæ’ä»¶ä¸»åŠ¨è°ƒç”¨ webview é¡µé¢ä¸Šçš„æ–¹æ³•
      const cb = this.callbacks[message.msgId] || this.callbacks[message.method]

      if (typeof cb === 'function') {
        try {
          cb(message.data)
        }
        catch (error) {
          console.log(`handleVscodeMsg: ${message.method} è°ƒç”¨å¤±è´¥`)
        }
        finally {
          delete this.callbacks[message.msgId]
        }
      }
      else {
        console.log(`handleVscodeMsg: ${message.msgId} å¯¹åº”çš„å›è°ƒå‡½æ•°ä¸å­˜åœ¨`)
        console.log('callbacks åˆ—è¡¨', this.callbacks)
      }
    }
  }


  /**
   * @description: å‘ vscode æ’ä»¶å‘é€æ¶ˆæ¯
   * @param {string} method  éœ€è¦è°ƒç”¨ vscode æ’ä»¶çš„æ–¹æ³•å
   * @param {any} data å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œå°±æ˜¯ä¼ é€’ç»™ vscode æ’ä»¶æ–¹æ³•çš„å‚æ•°ï¼Œå¦åˆ™å°±æ˜¯å›è°ƒå‡½æ•°
   * @param {Callback} cb å›è°ƒå‡½æ•°
   * @return {*}
   */
  callVscode(method: string, data?: any, cb?: Callback | CallbackWithReturnValue) {
    // å†æ¬¡åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦ vscode æ’ä»¶çš„webviewç¯å¢ƒ
    if (!this.vscode) {
      console.log(`å½“å‰ä¸åœ¨ vscode çš„ webview ä¸­, ä¸è¿›è¡Œ ${method} äº‹ä»¶çš„å‘é€`)
      return
    }

    let _data = data
    let _cb = cb

    // data: å¯èƒ½æ˜¯ä¸ªå‡½æ•°ï¼Œ å¦‚æœ data æ˜¯ä¸ªå‡½æ•°ï¼Œå°±ä¸ä¼šæœ‰å‚æ•°
    if (typeof data === 'function') {
      _cb = data
      _data = ''
    }

    // è·å– msgId
    const msgId = this.genMsgId()

    // å‘é€ç»™ vscode æ’ä»¶çš„æ¶ˆæ¯
    const sendData: MessageType = {
      from: 'chat-gpt-web',
      msgId,
      method,
      data: _data,
    }

    // ä¿å­˜ä¸€ä¸‹ å›è°ƒå‡½æ•°
    if (_cb) {
      this.callbacks[msgId] = _cb
    }

    console.log('å·²ç»ä¿å­˜çš„å›è°ƒå‡½æ•°æœ‰: ', this.callbacks)
    console.log('webviewå‘é€ç»™vscodeçš„å‚æ•°', sendData)

    if (this.vscode?.postMessage) {
      this.vscode?.postMessage(sendData)
    }
    else {
      console.log('vscode.postMessage is not a function')
    }
  }

```



vscodeè°ƒç”¨ webview çš„æ–¹æ³•

webview ä¼šå…ˆæ³¨å†Œæ–¹æ³•

```js
// åœ¨ vscode æ’ä»¶ä¸­ä¼šè°ƒç”¨è¯¥æ–¹æ³•
function askGptInvscode(res: any) {
  console.log('askGptInvscode', res)
  if (needLogin.value) {
    $callVscode('showInfo', 'è¯·å…ˆç™»å½•ï¼')
    return
  }
  // æ›´æ–° apikey
  updateSettings({ apiKey: res.apiKey })
  vscodeMsgType.value = res.type
  prompt.value = res.msg ?? ''
  handleSubmit()
}

$addVscodeCb('askGpt', askGptInvscode)
```





#### **è´¦å·ä¿¡æ¯çˆ¬å–æœåŠ¡**


è´¦å·ä¿¡æ¯çˆ¬å–æœåŠ¡æ˜¯ä¸€ä¸ªåœ¨ç”¨æˆ·æˆæƒä¸‹ï¼Œé€šè¿‡ç”¨æˆ·æä¾›çš„è¥åœ°IDå¯¹ç‹è€…è¥åœ°è¿›è¡Œæ•°æ®æŠ“å–çš„æœåŠ¡ã€‚è¯¥æœåŠ¡ä¸»è¦æå–ç”¨æˆ·è´¦å·ä¸‹çš„èµ„äº§ä¿¡æ¯ï¼ŒåŒ…æ‹¬è‹±é›„æ•°é‡ã€çš®è‚¤æ•°é‡ï¼Œå¹¶å°†è¿™äº›æ•°æ®ä¸è´¦å·è¿›è¡Œå…³è”ã€‚æ­¤æœåŠ¡ä¸ä»…è§£å†³äº†å•†å“æœç´¢ä¸å‡†ç¡®çš„é—®é¢˜ï¼Œè¿˜æå‡äº†è´¦å·çš„çœŸå®æ€§ï¼Œå¹¶ä¸ºéªŒå·æŠ¥å‘Šæä¾›äº†æ•°æ®åŸºç¡€ã€‚æœåŠ¡æˆåŠŸä¸Šçº¿åï¼Œä¸ºå…¬å¸å¸¦æ¥äº†æ˜¾è‘—çš„ä¸šåŠ¡ä»·å€¼ã€‚


æŠ€æœ¯æ ˆ ï¼šNodejs + Eggjs


1ã€åˆ†æç‹è€…è¥åœ°APPï¼Œä½¿ç”¨whistleè¿›è¡ŒæŠ“åŒ…åˆ†æï¼Œè·å–ä¸ªäººä¿¡æ¯æ¥å£åŠèµ„äº§ä¿¡æ¯æ¥å£ï¼Œå¹¶åˆ†æå…¶æ•°æ®ç»“æ„ã€‚
2ã€è®¾è®¡è®¾å¤‡ä¿¡æ¯èµ„æºæ± ä¸tokenæ± ï¼Œä»¥åŠtokenè¿‡æœŸé¢„è­¦æœºåˆ¶ï¼Œåœ¨è¯·æ±‚æ—¶è¿›è¡Œéšæœºç»„åˆï¼Œç”Ÿæˆè¯·æ±‚ä¿¡æ¯ï¼Œç¡®ä¿è¯·æ±‚çš„å¤šæ ·æ€§å’Œå®‰å…¨æ€§ã€‚
3ã€ä½¿ç”¨HTTPä»£ç†è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œéšè—çœŸå®IPåœ°å€ï¼Œå¹¶è®¾è®¡è¯·æ±‚å¤±è´¥çš„è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œæé«˜è¯·æ±‚çš„æˆåŠŸç‡å’Œç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚
4ã€å°è£…åŸŸåæ£€æµ‹ä¸­é—´ä»¶ï¼Œåªå…è®¸æ¥è‡ªå…¬å¸åŸŸåçš„è®¿é—®ï¼Œå‡å°‘éæ³•è¯·æ±‚çš„æ•°é‡ï¼Œå¢å¼ºç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚
5ã€æ¥å…¥å…¬å¸å†…éƒ¨çš„æ™®ç½—ç±³ä¿®æ–¯ç›‘æ§ç³»ç»Ÿå’Œä¼å¾®å‘Šè­¦å¹³å°ï¼Œç¡®ä¿é—®é¢˜èƒ½å¤ŸåŠæ—¶è·Ÿè¿›å’Œå¤„ç†ã€‚
6ã€äºŒæ¬¡å°è£…koa-ratelimitä¸­é—´ä»¶ï¼Œå®ç°æ¥å£é™æµï¼Œæ¯ç§’æœ€å¤š10æ¬¡ï¼Œé˜²æ­¢ä»£ç†è¯·æ±‚è¿‡è½½ã€‚
7ã€ä½¿ç”¨ pm2 è¿›è¡ŒæœåŠ¡çš„éƒ¨ç½²å’Œæ—¥å¿—ç®¡ç†ï¼Œç¡®ä¿æœåŠ¡çš„é«˜å¯ç”¨æ€§å’Œæ—¥å¿—çš„æœ‰æ•ˆè®°å½•ã€‚





##### éš¾ç‚¹





##### æµç¨‹



##### åŸŸåæ£€æµ‹

```js
// app/middleware/check_domain.js
module.exports = options => {
    return async function checkDomain(ctx, next) {
        const allowedDomains = options.domains;  // ä»é…ç½®ä¸­è¯»å–å…è®¸çš„åŸŸååˆ—è¡¨
        const requestDomain = ctx.host;  // è·å–è¯·æ±‚çš„åŸŸå

        if (allowedDomains.includes(requestDomain)) {
            await next();  // å¦‚æœè¯·æ±‚çš„åŸŸååœ¨å…è®¸çš„åˆ—è¡¨ä¸­ï¼Œç»§ç»­æ‰§è¡Œ
        } else {
            ctx.status = 403;  // ä¸å…è®¸çš„åŸŸåï¼Œè®¾ç½® HTTP çŠ¶æ€ç ä¸º 403
            ctx.body = 'Access denied';  // å¯ä»¥è‡ªå®šä¹‰æ‹’ç»è®¿é—®çš„å“åº”å†…å®¹
        }
    };
};


// config/config.default.js
exports.middleware = ['checkDomain'];
exports.checkDomain = {
    domains: ['allowed-domain.com', 'another-domain.com'],  // è¿™é‡Œå¡«å†™å…è®¸çš„åŸŸååˆ—è¡¨
};
```



##### é™æµ

```js
// ratelimit.js
const rateLimit = require('koa-ratelimit');
const Redis = require('ioredis');

module.exports = (options, app) => {
  const db = new Redis(options.redis);
  return rateLimit({
    driver: 'redis',
    db: db,
    duration: 60000, // é™æµçš„æ—¶é—´çª—å£ï¼Œè¿™é‡Œè®¾ç½®ä¸º 60 ç§’
    errorMessage: 'Sometimes You Just Have to Rate Limit.',
    id: (ctx) => ctx.ip,
    headers: {
      remaining: 'Rate-Limit-Remaining',
      reset: 'Rate-Limit-Reset',
      total: 'Rate-Limit-Total'
    },
    max: 100, // 60 ç§’å†…æœ€å¤šè¯·æ±‚ 100 æ¬¡
  });
};


// app/router.js
const rateLimit = require('../middleware/ratelimit');
module.exports = app => {
  const { router, controller } = app;
  router.get('/api', rateLimit(app.config.ratelimit), controller.home.index);
};

```

##### å‘Šè­¦

```

```



##### æ—¥å¿—ç®¡ç†



## å…¶ä»–é—®é¢˜



## å‹‡å“¥é¢è¯•å»ºè®®

> å¯¹ä¸šåŠ¡çš„æ€è·¯ä¸Šé¢

é¡¹ç›®æ€ä¹ˆå¼„å‡ºæ¥çš„ï¼Ÿ æ€ä¹ˆè§£å†³ä¸šåŠ¡çš„ç—›ç‚¹ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿæ²‰æ·€äº†ä»€ä¹ˆï¼Ÿ åæ€äº†ä»€ä¹ˆï¼Ÿå¦‚ä½•éªŒè¯äº†ä¸šåŠ¡æ•ˆæœï¼Ÿ



æ€ä¹ˆåšä¸šåŠ¡? æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ 



å›ç­”é—®é¢˜ï¼š

- å›ç­”é¢è¯•å®˜çš„é—®é¢˜
- ä¼˜åŒ–ã€æ”¹è¿›
- è‡ªå¸¦å‡ºæ¥å…¶ä»–çš„æˆ‘é—®é¢˜



ç¼–ç¨‹ï¼š

- å…ˆæ€è€ƒã€ä¸ºä»€ä¹ˆåœ¨å‡ºè¿™ä¸ªæï¼Œå…ˆæƒ³å¥½ï¼Œæƒ³è€ƒå¯Ÿä»€ä¹ˆï¼Œå†å†™
- å…ˆæ€è€ƒå¥½äº†ï¼Œåœ¨å†™

- è§„èŒƒ
- ä¸¥è°¨
- è¾¹ç•Œè€ƒè™‘
- è¾“å…¥è¿”å›
- æ€ç»´æ–¹å¼
- ä¸¥è°¨ã€å·¥æ•´ã€åˆç†ã€å¥å£®ã€åœ¨ä¼˜åŒ–
- æ’å…¥ã€è¾¹ç•Œçš„å¤„ç†ã€è¾“å…¥å’Œè¿”å›



hr é—®åŸå› ï¼š

èŒçº§ï¼š

ç”Ÿæ´»å‹åŠ›ï¼š

1ã€ç­¾å­—è´¹ æ²¡æœ‰ç­¾è¯è´¹ 

2ã€è–ªèµ„

3ã€å¸¸è§„æ–¹æ¡ˆï¼š 30%ï¼Œ 2-1ï¼Œ æˆ‘è¿˜æ˜¯å¾ˆæƒ³å»å­—èŠ‚è¿™è¾¹ï¼Œ 40%

4ã€å‘å±•ç©ºé—´æœ‰é™ã€‚æƒ³å»æ›´å¤§çš„å¹³å°ï¼ŒåŒäº‹æ¨è





å›ç­”é¢è¯•å®˜çš„é—®é¢˜ï¼Œè‡ªå¸¦å‡ºæ¥å…¶ä»–çš„æˆ‘é—®é¢˜

ä¼˜åŒ–ã€æ”¹è¿›

é¢è¯•å®˜é—®çš„æ˜¯ä»€ä¹ˆï¼Ÿå°¤å…¶æ˜¯ç­”æ¡ˆä¸ä¸€æ ·ä»€ä¹ˆï¼Ÿ

æ¯”å¦‚ï¼š æ•°æ®ä¸ä¸€è‡´æ€ä¹ˆçœ‹ï¼Ÿ

æ¯ä¸ªé—®é¢˜å›ç­”å‡ ä¸ªç‚¹ï¼Œå±‚å±‚é€’è¿›ã€åŒ…æ‹¬æ€è€ƒ

